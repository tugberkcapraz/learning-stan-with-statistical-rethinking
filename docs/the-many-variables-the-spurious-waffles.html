<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 The Many Variables &amp; The Spurious Waffles | Learning Stan with Statistical Retinking</title>
  <meta name="description" content="Chapter 2 The Many Variables &amp; The Spurious Waffles | Learning Stan with Statistical Retinking" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 The Many Variables &amp; The Spurious Waffles | Learning Stan with Statistical Retinking" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 The Many Variables &amp; The Spurious Waffles | Learning Stan with Statistical Retinking" />
  
  
  

<meta name="author" content="Kerem Tugberk Capraz" />


<meta name="date" content="2021-07-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>

<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Work in Progress</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Geocentric Models</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>1.1</b> Gaussian Model of Height</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#using-stan-for-the-first-time"><i class="fa fa-check"></i><b>1.1.1</b> Using Stan for the First Time</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#linear-prediction"><i class="fa fa-check"></i><b>1.2</b> Linear Prediction</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#curves-from-lines"><i class="fa fa-check"></i><b>1.3</b> Curves From Lines</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#linear"><i class="fa fa-check"></i><b>1.3.1</b> Linear</a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#quadratic"><i class="fa fa-check"></i><b>1.3.2</b> Quadratic</a></li>
<li class="chapter" data-level="1.3.3" data-path="index.html"><a href="index.html#cubic"><i class="fa fa-check"></i><b>1.3.3</b> Cubic</a></li>
<li class="chapter" data-level="1.3.4" data-path="index.html"><a href="index.html#b-splines"><i class="fa fa-check"></i><b>1.3.4</b> B-Splines</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>2</b> The Many Variables &amp; The Spurious Waffles</a>
<ul>
<li class="chapter" data-level="2.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#spurious-association"><i class="fa fa-check"></i><b>2.1</b> Spurious Association</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#posterior-prediction-plots"><i class="fa fa-check"></i><b>2.1.1</b> Posterior Prediction Plots</a></li>
<li class="chapter" data-level="2.1.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#counterfactual-plots"><i class="fa fa-check"></i><b>2.1.2</b> Counterfactual Plots</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>2.2</b> Masked Relationship</a></li>
<li class="chapter" data-level="2.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#categorical-variables"><i class="fa fa-check"></i><b>2.3</b> Categorical Variables</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#indicator-variables"><i class="fa fa-check"></i><b>2.3.1</b> Indicator Variables</a></li>
<li class="chapter" data-level="2.3.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#index-variables"><i class="fa fa-check"></i><b>2.3.2</b> Index Variables</a></li>
<li class="chapter" data-level="2.3.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#many-variables"><i class="fa fa-check"></i><b>2.3.3</b> Many Variables</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Learning Stan with Statistical Retinking</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-many-variables-the-spurious-waffles" class="section level1" number="2">
<h1><span class="header-section-number">Chapter 2</span> The Many Variables &amp; The Spurious Waffles</h1>
<p><span class="math display">\[\newcommand{\ci}{\perp\!\!\!\perp}\]</span></p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="the-many-variables-the-spurious-waffles.html#cb79-1" aria-hidden="true"></a><span class="kw">library</span>(rethinking)</span>
<span id="cb79-2"><a href="the-many-variables-the-spurious-waffles.html#cb79-2" aria-hidden="true"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb79-3"><a href="the-many-variables-the-spurious-waffles.html#cb79-3" aria-hidden="true"></a><span class="kw">library</span>(rstan)</span>
<span id="cb79-4"><a href="the-many-variables-the-spurious-waffles.html#cb79-4" aria-hidden="true"></a><span class="kw">library</span>(brms)</span>
<span id="cb79-5"><a href="the-many-variables-the-spurious-waffles.html#cb79-5" aria-hidden="true"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb79-6"><a href="the-many-variables-the-spurious-waffles.html#cb79-6" aria-hidden="true"></a><span class="kw">library</span>(tidybayes)</span>
<span id="cb79-7"><a href="the-many-variables-the-spurious-waffles.html#cb79-7" aria-hidden="true"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb79-8"><a href="the-many-variables-the-spurious-waffles.html#cb79-8" aria-hidden="true"></a><span class="kw">library</span>(patchwork)</span>
<span id="cb79-9"><a href="the-many-variables-the-spurious-waffles.html#cb79-9" aria-hidden="true"></a><span class="kw">library</span>(brms)</span>
<span id="cb79-10"><a href="the-many-variables-the-spurious-waffles.html#cb79-10" aria-hidden="true"></a><span class="kw">library</span>(dagitty)</span>
<span id="cb79-11"><a href="the-many-variables-the-spurious-waffles.html#cb79-11" aria-hidden="true"></a><span class="kw">library</span>(ggdag)</span></code></pre></div>
<div id="spurious-association" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Spurious Association</h2>
<p>In the first section of this chapter we are going to deal with the milk data. Let’s load it and apply desired tranformations on it.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="the-many-variables-the-spurious-waffles.html#cb80-1" aria-hidden="true"></a><span class="co">#load data and copy</span></span>
<span id="cb80-2"><a href="the-many-variables-the-spurious-waffles.html#cb80-2" aria-hidden="true"></a><span class="kw">data</span>(WaffleDivorce)</span>
<span id="cb80-3"><a href="the-many-variables-the-spurious-waffles.html#cb80-3" aria-hidden="true"></a>d &lt;-<span class="st"> </span>WaffleDivorce</span></code></pre></div>
<p>As data contained missing values, we decided to use only the cases for our three variables. After we make sure that there’s nothing missing. Let’s move on with standardization</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="the-many-variables-the-spurious-waffles.html#cb81-1" aria-hidden="true"></a><span class="co">#standardise the variables</span></span>
<span id="cb81-2"><a href="the-many-variables-the-spurious-waffles.html#cb81-2" aria-hidden="true"></a>d<span class="op">$</span>A &lt;-<span class="st"> </span>( d<span class="op">$</span>MedianAgeMarriage <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(d<span class="op">$</span>MedianAgeMarriage) ) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(d<span class="op">$</span>MedianAgeMarriage)</span>
<span id="cb81-3"><a href="the-many-variables-the-spurious-waffles.html#cb81-3" aria-hidden="true"></a>d<span class="op">$</span>M &lt;-<span class="st"> </span>( d<span class="op">$</span>Marriage <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(d<span class="op">$</span>Marriage) ) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(d<span class="op">$</span>Marriage)</span>
<span id="cb81-4"><a href="the-many-variables-the-spurious-waffles.html#cb81-4" aria-hidden="true"></a>d<span class="op">$</span>D &lt;-<span class="st"> </span>(d<span class="op">$</span>Divorce <span class="op">-</span><span class="st"> </span><span class="kw">mean</span> (d<span class="op">$</span>Divorce) ) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(d<span class="op">$</span>Divorce)</span></code></pre></div>
<p>In the book McElrath used <code>scale</code> function but I wanted to do it manually. Basicall standardization is:
<span class="math display">\[ z_i = \frac{ X_i - \bar{X}} {sd(X)} \]</span>
resulting is the standardized vector</p>
<p>Before doing anything with our standardized variables let’s fit those two models in McElreath’s double plot</p>
<p>First model is</p>
<p><span class="math display">\[\ \ \ \ \ \ \ \ D_i \sim \mathrm{Normal}(\mu_i, \sigma) \\
\mu_i = \alpha + \beta_{A} A_i \\
\ \ \ \ \ \ \ \ \alpha \sim \mathrm{Normal(0, 0.2)} \\
\ \ \ \ \ \ \ \ \beta \sim \mathrm{Normal(0, 0.5)} \\
\ \ \ \ \ \ \ \ \ \sigma \sim \mathrm{Exponential(1)}\]</span></p>
<p>Stan data for the right handside plot</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="the-many-variables-the-spurious-waffles.html#cb82-1" aria-hidden="true"></a>dat_<span class="dv">5</span>_<span class="dv">1</span>_a &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">N=</span><span class="kw">NROW</span>(d),</span>
<span id="cb82-2"><a href="the-many-variables-the-spurious-waffles.html#cb82-2" aria-hidden="true"></a>                  <span class="dt">X =</span> d<span class="op">$</span>A,</span>
<span id="cb82-3"><a href="the-many-variables-the-spurious-waffles.html#cb82-3" aria-hidden="true"></a>                  <span class="dt">D =</span> d<span class="op">$</span>D)</span></code></pre></div>
<pre class="stan"><code>data {
  int&lt;lower=0&gt; N;
  vector[N] X;
  vector[N] D;
}

parameters {
  real alpha;
  real beta; 
  real&lt;lower=0&gt; sigma;
}
transformed parameters{
vector[N] mu =  alpha + beta * X;
}
model {
  D ~ normal(mu, sigma);
  alpha ~ normal(0, 0.2);
  beta ~ normal(0, 0.5);
  sigma ~ exponential(1);
}
</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="the-many-variables-the-spurious-waffles.html#cb84-1" aria-hidden="true"></a><span class="co">#Sampling </span></span>
<span id="cb84-2"><a href="the-many-variables-the-spurious-waffles.html#cb84-2" aria-hidden="true"></a>fit_<span class="dv">5</span>_<span class="dv">1</span>_a &lt;-<span class="st"> </span><span class="kw">sampling</span>(double_plot_model.stan, dat_<span class="dv">5</span>_<span class="dv">1</span>_a, </span>
<span id="cb84-3"><a href="the-many-variables-the-spurious-waffles.html#cb84-3" aria-hidden="true"></a>                      <span class="dt">iter=</span><span class="dv">1000</span>,</span>
<span id="cb84-4"><a href="the-many-variables-the-spurious-waffles.html#cb84-4" aria-hidden="true"></a>                      <span class="dt">chains=</span><span class="dv">2</span>,</span>
<span id="cb84-5"><a href="the-many-variables-the-spurious-waffles.html#cb84-5" aria-hidden="true"></a>                      <span class="dt">cores=</span><span class="dv">4</span>)</span></code></pre></div>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="the-many-variables-the-spurious-waffles.html#cb85-1" aria-hidden="true"></a>d_right_plot &lt;-</span>
<span id="cb85-2"><a href="the-many-variables-the-spurious-waffles.html#cb85-2" aria-hidden="true"></a><span class="st">  </span>fit_<span class="dv">5</span>_<span class="dv">1</span>_a <span class="op">%&gt;%</span></span>
<span id="cb85-3"><a href="the-many-variables-the-spurious-waffles.html#cb85-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">gather_draws</span>(mu[i]) <span class="op">%&gt;%</span></span>
<span id="cb85-4"><a href="the-many-variables-the-spurious-waffles.html#cb85-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mean_qi</span>() <span class="op">%&gt;%</span></span>
<span id="cb85-5"><a href="the-many-variables-the-spurious-waffles.html#cb85-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">mu =</span> .value,</span>
<span id="cb85-6"><a href="the-many-variables-the-spurious-waffles.html#cb85-6" aria-hidden="true"></a>         <span class="dt">lower =</span> .lower,</span>
<span id="cb85-7"><a href="the-many-variables-the-spurious-waffles.html#cb85-7" aria-hidden="true"></a>         <span class="dt">upper =</span> .upper)</span>
<span id="cb85-8"><a href="the-many-variables-the-spurious-waffles.html#cb85-8" aria-hidden="true"></a></span>
<span id="cb85-9"><a href="the-many-variables-the-spurious-waffles.html#cb85-9" aria-hidden="true"></a>d_right_plot<span class="op">$</span>D &lt;-<span class="st"> </span><span class="kw">scale</span>(d<span class="op">$</span>Divorce) </span>
<span id="cb85-10"><a href="the-many-variables-the-spurious-waffles.html#cb85-10" aria-hidden="true"></a>d_right_plot<span class="op">$</span>A &lt;-<span class="st"> </span><span class="kw">scale</span>(d<span class="op">$</span>MedianAgeMarriage)</span>
<span id="cb85-11"><a href="the-many-variables-the-spurious-waffles.html#cb85-11" aria-hidden="true"></a></span>
<span id="cb85-12"><a href="the-many-variables-the-spurious-waffles.html#cb85-12" aria-hidden="true"></a><span class="co"># Aesthetics X</span></span>
<span id="cb85-13"><a href="the-many-variables-the-spurious-waffles.html#cb85-13" aria-hidden="true"></a>rescale_x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dt">by=</span><span class="dv">1</span>)</span>
<span id="cb85-14"><a href="the-many-variables-the-spurious-waffles.html#cb85-14" aria-hidden="true"></a>x_labels &lt;-<span class="st"> </span>rescale_x <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(d<span class="op">$</span>MedianAgeMarriage) <span class="op">+</span><span class="st"> </span><span class="kw">mean</span>(d<span class="op">$</span>MedianAgeMarriage)</span>
<span id="cb85-15"><a href="the-many-variables-the-spurious-waffles.html#cb85-15" aria-hidden="true"></a><span class="co"># Aesthetics Y</span></span>
<span id="cb85-16"><a href="the-many-variables-the-spurious-waffles.html#cb85-16" aria-hidden="true"></a>rescale_y &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dt">by=</span><span class="dv">1</span>)</span>
<span id="cb85-17"><a href="the-many-variables-the-spurious-waffles.html#cb85-17" aria-hidden="true"></a>y_labels &lt;-<span class="st"> </span>rescale_x <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(d<span class="op">$</span>Divorce) <span class="op">+</span><span class="st"> </span><span class="kw">mean</span>(d<span class="op">$</span>Divorce)</span>
<span id="cb85-18"><a href="the-many-variables-the-spurious-waffles.html#cb85-18" aria-hidden="true"></a>  </span>
<span id="cb85-19"><a href="the-many-variables-the-spurious-waffles.html#cb85-19" aria-hidden="true"></a>  </span>
<span id="cb85-20"><a href="the-many-variables-the-spurious-waffles.html#cb85-20" aria-hidden="true"></a><span class="kw">ggplot</span>(d_right_plot) <span class="op">+</span></span>
<span id="cb85-21"><a href="the-many-variables-the-spurious-waffles.html#cb85-21" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span>A , <span class="dt">y=</span>D)) <span class="op">+</span></span>
<span id="cb85-22"><a href="the-many-variables-the-spurious-waffles.html#cb85-22" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> A, <span class="dt">ymin=</span>lower, <span class="dt">ymax=</span>upper), <span class="dt">alpha=</span><span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb85-23"><a href="the-many-variables-the-spurious-waffles.html#cb85-23" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>A , <span class="dt">y=</span>mu),<span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb85-24"><a href="the-many-variables-the-spurious-waffles.html#cb85-24" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> rescale_x,</span>
<span id="cb85-25"><a href="the-many-variables-the-spurious-waffles.html#cb85-25" aria-hidden="true"></a>                     <span class="dt">labels =</span> <span class="kw">round</span>(x_labels, <span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb85-26"><a href="the-many-variables-the-spurious-waffles.html#cb85-26" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> rescale_y,</span>
<span id="cb85-27"><a href="the-many-variables-the-spurious-waffles.html#cb85-27" aria-hidden="true"></a>                     <span class="dt">labels =</span> <span class="kw">round</span>(y_labels, <span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb85-28"><a href="the-many-variables-the-spurious-waffles.html#cb85-28" aria-hidden="true"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Median Age at Marriage&quot;</span>) <span class="op">+</span></span>
<span id="cb85-29"><a href="the-many-variables-the-spurious-waffles.html#cb85-29" aria-hidden="true"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Divorce Rate&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-67-1.png" width="100%" /></p>
<p>And second Model</p>
<p><span class="math display">\[\ \ \ \ \ \ \ \ D_i \sim \mathrm{Normal}(\mu_i, \sigma) \\
\mu_i = \alpha + \beta_{M} M_i \\
\ \ \ \ \ \ \ \ \alpha \sim \mathrm{Normal(0, 0.2)} \\
\ \ \ \ \ \ \ \ \beta \sim \mathrm{Normal(0, 0.5)} \\
\ \ \ \ \ \ \ \ \ \sigma \sim \mathrm{Exponential(1)}\]</span></p>
<p>Stan data for the right handside plot</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="the-many-variables-the-spurious-waffles.html#cb86-1" aria-hidden="true"></a>dat_<span class="dv">5</span>_<span class="dv">1</span>_b &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">N=</span><span class="kw">NROW</span>(d),</span>
<span id="cb86-2"><a href="the-many-variables-the-spurious-waffles.html#cb86-2" aria-hidden="true"></a>                  <span class="dt">X =</span> d<span class="op">$</span>M,</span>
<span id="cb86-3"><a href="the-many-variables-the-spurious-waffles.html#cb86-3" aria-hidden="true"></a>                  <span class="dt">D =</span> d<span class="op">$</span>D)</span></code></pre></div>
<p>Notice we are using same model with different data</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="the-many-variables-the-spurious-waffles.html#cb87-1" aria-hidden="true"></a><span class="co">#Sampling </span></span>
<span id="cb87-2"><a href="the-many-variables-the-spurious-waffles.html#cb87-2" aria-hidden="true"></a>fit_<span class="dv">5</span>_<span class="dv">1</span>_b &lt;-<span class="st"> </span><span class="kw">sampling</span>(double_plot_model.stan,</span>
<span id="cb87-3"><a href="the-many-variables-the-spurious-waffles.html#cb87-3" aria-hidden="true"></a>                      dat_<span class="dv">5</span>_<span class="dv">1</span>_b, </span>
<span id="cb87-4"><a href="the-many-variables-the-spurious-waffles.html#cb87-4" aria-hidden="true"></a>                      <span class="dt">iter=</span><span class="dv">1000</span>,</span>
<span id="cb87-5"><a href="the-many-variables-the-spurious-waffles.html#cb87-5" aria-hidden="true"></a>                      <span class="dt">chains=</span><span class="dv">2</span>,</span>
<span id="cb87-6"><a href="the-many-variables-the-spurious-waffles.html#cb87-6" aria-hidden="true"></a>                      <span class="dt">cores=</span><span class="dv">4</span>)</span></code></pre></div>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="the-many-variables-the-spurious-waffles.html#cb88-1" aria-hidden="true"></a>d_left_plot &lt;-</span>
<span id="cb88-2"><a href="the-many-variables-the-spurious-waffles.html#cb88-2" aria-hidden="true"></a><span class="st">  </span>fit_<span class="dv">5</span>_<span class="dv">1</span>_b <span class="op">%&gt;%</span></span>
<span id="cb88-3"><a href="the-many-variables-the-spurious-waffles.html#cb88-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">gather_draws</span>(mu[i]) <span class="op">%&gt;%</span></span>
<span id="cb88-4"><a href="the-many-variables-the-spurious-waffles.html#cb88-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mean_qi</span>() <span class="op">%&gt;%</span></span>
<span id="cb88-5"><a href="the-many-variables-the-spurious-waffles.html#cb88-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">mu =</span> .value,</span>
<span id="cb88-6"><a href="the-many-variables-the-spurious-waffles.html#cb88-6" aria-hidden="true"></a>         <span class="dt">lower =</span> .lower,</span>
<span id="cb88-7"><a href="the-many-variables-the-spurious-waffles.html#cb88-7" aria-hidden="true"></a>         <span class="dt">upper =</span> .upper)</span>
<span id="cb88-8"><a href="the-many-variables-the-spurious-waffles.html#cb88-8" aria-hidden="true"></a></span>
<span id="cb88-9"><a href="the-many-variables-the-spurious-waffles.html#cb88-9" aria-hidden="true"></a>d_left_plot<span class="op">$</span>D &lt;-<span class="st"> </span><span class="kw">scale</span>(d<span class="op">$</span>Divorce) </span>
<span id="cb88-10"><a href="the-many-variables-the-spurious-waffles.html#cb88-10" aria-hidden="true"></a>d_left_plot<span class="op">$</span>M &lt;-<span class="st"> </span><span class="kw">scale</span>(d<span class="op">$</span>Marriage)</span>
<span id="cb88-11"><a href="the-many-variables-the-spurious-waffles.html#cb88-11" aria-hidden="true"></a></span>
<span id="cb88-12"><a href="the-many-variables-the-spurious-waffles.html#cb88-12" aria-hidden="true"></a><span class="co"># Aesthetics X</span></span>
<span id="cb88-13"><a href="the-many-variables-the-spurious-waffles.html#cb88-13" aria-hidden="true"></a>rescale_x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dt">by=</span><span class="dv">1</span>)</span>
<span id="cb88-14"><a href="the-many-variables-the-spurious-waffles.html#cb88-14" aria-hidden="true"></a>x_labels &lt;-<span class="st"> </span>rescale_x <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(d<span class="op">$</span>Marriage) <span class="op">+</span><span class="st"> </span><span class="kw">mean</span>(d<span class="op">$</span>Marriage)</span>
<span id="cb88-15"><a href="the-many-variables-the-spurious-waffles.html#cb88-15" aria-hidden="true"></a>  </span>
<span id="cb88-16"><a href="the-many-variables-the-spurious-waffles.html#cb88-16" aria-hidden="true"></a><span class="kw">ggplot</span>(d_left_plot) <span class="op">+</span></span>
<span id="cb88-17"><a href="the-many-variables-the-spurious-waffles.html#cb88-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span>M , <span class="dt">y=</span>D)) <span class="op">+</span></span>
<span id="cb88-18"><a href="the-many-variables-the-spurious-waffles.html#cb88-18" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> M, <span class="dt">ymin=</span>lower, <span class="dt">ymax=</span>upper), <span class="dt">alpha=</span><span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb88-19"><a href="the-many-variables-the-spurious-waffles.html#cb88-19" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>M , <span class="dt">y=</span>mu),<span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb88-20"><a href="the-many-variables-the-spurious-waffles.html#cb88-20" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> rescale_x,</span>
<span id="cb88-21"><a href="the-many-variables-the-spurious-waffles.html#cb88-21" aria-hidden="true"></a>                     <span class="dt">labels =</span> <span class="kw">round</span>(x_labels, <span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb88-22"><a href="the-many-variables-the-spurious-waffles.html#cb88-22" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> rescale_y,</span>
<span id="cb88-23"><a href="the-many-variables-the-spurious-waffles.html#cb88-23" aria-hidden="true"></a>                     <span class="dt">labels =</span> <span class="kw">round</span>(y_labels, <span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb88-24"><a href="the-many-variables-the-spurious-waffles.html#cb88-24" aria-hidden="true"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Marriage Rate&quot;</span>) <span class="op">+</span></span>
<span id="cb88-25"><a href="the-many-variables-the-spurious-waffles.html#cb88-25" aria-hidden="true"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Divorce Rate&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-70-1.png" width="100%" /></p>
<p>Yes we did the modelling but how about the priors? What do we know about them? Just like the last chapter, let’s use simulations to see what they tell us about our model before any data.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="the-many-variables-the-spurious-waffles.html#cb89-1" aria-hidden="true"></a>prior_alpha &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="fl">0.2</span>)</span>
<span id="cb89-2"><a href="the-many-variables-the-spurious-waffles.html#cb89-2" aria-hidden="true"></a>prior_beta  &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="fl">-0.25</span>, <span class="fl">0.25</span>)</span>
<span id="cb89-3"><a href="the-many-variables-the-spurious-waffles.html#cb89-3" aria-hidden="true"></a>prior_sigma &lt;-<span class="st"> </span><span class="kw">rexp</span>(<span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb89-4"><a href="the-many-variables-the-spurious-waffles.html#cb89-4" aria-hidden="true"></a></span>
<span id="cb89-5"><a href="the-many-variables-the-spurious-waffles.html#cb89-5" aria-hidden="true"></a><span class="co">#plot them</span></span>
<span id="cb89-6"><a href="the-many-variables-the-spurious-waffles.html#cb89-6" aria-hidden="true"></a><span class="kw">plot</span>(<span class="ot">NULL</span>, <span class="dt">xlim=</span><span class="kw">range</span>(d<span class="op">$</span>A), <span class="dt">ylim =</span> <span class="kw">range</span>(d<span class="op">$</span>D), <span class="dt">xlab =</span> <span class="st">&quot;Median age of marriage&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Divorce Rate&quot;</span>)</span>
<span id="cb89-7"><a href="the-many-variables-the-spurious-waffles.html#cb89-7" aria-hidden="true"></a><span class="kw">mtext</span>( <span class="st">&quot;constructed slopes for beta ~ dnorm(-0.25, 0.25)&quot;</span> ) <span class="co"># label</span></span>
<span id="cb89-8"><a href="the-many-variables-the-spurious-waffles.html#cb89-8" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="dv">1</span> <span class="co"># constant</span></span>
<span id="cb89-9"><a href="the-many-variables-the-spurious-waffles.html#cb89-9" aria-hidden="true"></a>xbar &lt;-<span class="st"> </span><span class="dv">1</span> <span class="co"># constant mean</span></span>
<span id="cb89-10"><a href="the-many-variables-the-spurious-waffles.html#cb89-10" aria-hidden="true"></a>N &lt;-<span class="st"> </span><span class="dv">100</span> <span class="co"># number of observations</span></span>
<span id="cb89-11"><a href="the-many-variables-the-spurious-waffles.html#cb89-11" aria-hidden="true"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>N ) <span class="kw">curve</span>(prior_alpha[i] <span class="op">+</span><span class="st"> </span>prior_beta[i]<span class="op">*</span>x, </span>
<span id="cb89-12"><a href="the-many-variables-the-spurious-waffles.html#cb89-12" aria-hidden="true"></a>                      <span class="dt">from =</span> <span class="kw">min</span>(d<span class="op">$</span>A), <span class="dt">to=</span><span class="kw">max</span>(d<span class="op">$</span>D), <span class="dt">add =</span> <span class="ot">TRUE</span>,</span>
<span id="cb89-13"><a href="the-many-variables-the-spurious-waffles.html#cb89-13" aria-hidden="true"></a>                      <span class="dt">col =</span> <span class="kw">col.alpha</span>(<span class="st">&quot;black&quot;</span>, <span class="fl">0.4</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-71-1.png" width="100%" /></p>
<p>They are in fact reasonable priors. But is setting reasonable priors and writing down good stan code is enough for making causal claims? No! As the McElreath spends decent amount of time explaining why in chapters 5 and 6 of the book, causal inference is something different. First let’s draw some DAGS to see how we conceptualize the relationships among our variables</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="the-many-variables-the-spurious-waffles.html#cb90-1" aria-hidden="true"></a>dag_coords &lt;-</span>
<span id="cb90-2"><a href="the-many-variables-the-spurious-waffles.html#cb90-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;D&quot;</span>),</span>
<span id="cb90-3"><a href="the-many-variables-the-spurious-waffles.html#cb90-3" aria-hidden="true"></a>         <span class="dt">x    =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>),</span>
<span id="cb90-4"><a href="the-many-variables-the-spurious-waffles.html#cb90-4" aria-hidden="true"></a>         <span class="dt">y    =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb90-5"><a href="the-many-variables-the-spurious-waffles.html#cb90-5" aria-hidden="true"></a></span>
<span id="cb90-6"><a href="the-many-variables-the-spurious-waffles.html#cb90-6" aria-hidden="true"></a>dag_<span class="dv">1</span> &lt;-</span>
<span id="cb90-7"><a href="the-many-variables-the-spurious-waffles.html#cb90-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">dagify</span>(M <span class="op">~</span><span class="st"> </span>A,</span>
<span id="cb90-8"><a href="the-many-variables-the-spurious-waffles.html#cb90-8" aria-hidden="true"></a>         D <span class="op">~</span><span class="st"> </span>A <span class="op">+</span><span class="st"> </span>M,</span>
<span id="cb90-9"><a href="the-many-variables-the-spurious-waffles.html#cb90-9" aria-hidden="true"></a>         <span class="dt">coords =</span> dag_coords)</span>
<span id="cb90-10"><a href="the-many-variables-the-spurious-waffles.html#cb90-10" aria-hidden="true"></a>  </span>
<span id="cb90-11"><a href="the-many-variables-the-spurious-waffles.html#cb90-11" aria-hidden="true"></a>p_dag_<span class="dv">1</span> &lt;-<span class="st"> </span></span>
<span id="cb90-12"><a href="the-many-variables-the-spurious-waffles.html#cb90-12" aria-hidden="true"></a><span class="st">  </span>dag_<span class="dv">1</span><span class="op">%&gt;%</span></span>
<span id="cb90-13"><a href="the-many-variables-the-spurious-waffles.html#cb90-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">xend =</span> xend, <span class="dt">yend =</span> yend)) <span class="op">+</span></span>
<span id="cb90-14"><a href="the-many-variables-the-spurious-waffles.html#cb90-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_dag_point</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">size =</span> <span class="dv">10</span>) <span class="op">+</span></span>
<span id="cb90-15"><a href="the-many-variables-the-spurious-waffles.html#cb90-15" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_dag_text</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb90-16"><a href="the-many-variables-the-spurious-waffles.html#cb90-16" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_dag_edges</span>(<span class="dt">edge_color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb90-17"><a href="the-many-variables-the-spurious-waffles.html#cb90-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.1</span>)) <span class="op">+</span></span>
<span id="cb90-18"><a href="the-many-variables-the-spurious-waffles.html#cb90-18" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.1</span>)) <span class="op">+</span></span>
<span id="cb90-19"><a href="the-many-variables-the-spurious-waffles.html#cb90-19" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb90-20"><a href="the-many-variables-the-spurious-waffles.html#cb90-20" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</span>
<span id="cb90-21"><a href="the-many-variables-the-spurious-waffles.html#cb90-21" aria-hidden="true"></a></span>
<span id="cb90-22"><a href="the-many-variables-the-spurious-waffles.html#cb90-22" aria-hidden="true"></a>p_dag_<span class="dv">1</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-72-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>The dag above corresponds to 3 assumptions</p>
<pre><code>1. A directly influences M
2. A directly influences D
3. M directly influences D
4. A indirectly influences D over M</code></pre>
<p>This is one way to depict a causal model. But we don’t have one causal explanation mechanism for this data. Think about for a while. Do you really think Marriage rate has direct influence on Divorce, or median age at marriage as being common cause of both marriage rate and Divorce, creates a spurious correlation between marriage rate and divorce? Let’s depict that one and try to find ways to answer this question.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="the-many-variables-the-spurious-waffles.html#cb92-1" aria-hidden="true"></a>dag_<span class="dv">2</span> &lt;-</span>
<span id="cb92-2"><a href="the-many-variables-the-spurious-waffles.html#cb92-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">dagify</span>(M <span class="op">~</span><span class="st"> </span>A,</span>
<span id="cb92-3"><a href="the-many-variables-the-spurious-waffles.html#cb92-3" aria-hidden="true"></a>         D <span class="op">~</span><span class="st"> </span>A,</span>
<span id="cb92-4"><a href="the-many-variables-the-spurious-waffles.html#cb92-4" aria-hidden="true"></a>         <span class="dt">coords =</span> dag_coords) </span>
<span id="cb92-5"><a href="the-many-variables-the-spurious-waffles.html#cb92-5" aria-hidden="true"></a>  </span>
<span id="cb92-6"><a href="the-many-variables-the-spurious-waffles.html#cb92-6" aria-hidden="true"></a>p_dag_<span class="dv">2</span> &lt;-<span class="st"> </span>dag_<span class="dv">2</span><span class="op">%&gt;%</span></span>
<span id="cb92-7"><a href="the-many-variables-the-spurious-waffles.html#cb92-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">xend =</span> xend, <span class="dt">yend =</span> yend)) <span class="op">+</span></span>
<span id="cb92-8"><a href="the-many-variables-the-spurious-waffles.html#cb92-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_dag_point</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">size =</span> <span class="dv">10</span>) <span class="op">+</span></span>
<span id="cb92-9"><a href="the-many-variables-the-spurious-waffles.html#cb92-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_dag_text</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb92-10"><a href="the-many-variables-the-spurious-waffles.html#cb92-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_dag_edges</span>(<span class="dt">edge_color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb92-11"><a href="the-many-variables-the-spurious-waffles.html#cb92-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.1</span>)) <span class="op">+</span></span>
<span id="cb92-12"><a href="the-many-variables-the-spurious-waffles.html#cb92-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.1</span>)) <span class="op">+</span></span>
<span id="cb92-13"><a href="the-many-variables-the-spurious-waffles.html#cb92-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb92-14"><a href="the-many-variables-the-spurious-waffles.html#cb92-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</span>
<span id="cb92-15"><a href="the-many-variables-the-spurious-waffles.html#cb92-15" aria-hidden="true"></a></span>
<span id="cb92-16"><a href="the-many-variables-the-spurious-waffles.html#cb92-16" aria-hidden="true"></a>p_dag_<span class="dv">2</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-73-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>For that one we have to check conditional independencies that each DAG assumes.
First DAG has no conditional independency. However, second DAG says M should be conditionally independent of D. <span class="math inline">\(D \ci \mathrm{M | D}\)</span> in formal notation.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="the-many-variables-the-spurious-waffles.html#cb93-1" aria-hidden="true"></a><span class="kw">print</span>(<span class="kw">impliedConditionalIndependencies</span>(dag_<span class="dv">1</span>))</span></code></pre></div>
<p>Let’s use dagity for both dags</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="the-many-variables-the-spurious-waffles.html#cb94-1" aria-hidden="true"></a><span class="kw">impliedConditionalIndependencies</span>(dag_<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## D _||_ M | A</code></pre>
<blockquote>
<p>Let’s try to summarize. The testable implications of the first DAG are that all pairs of vari- ables &gt;should be associated, whatever we condition on. The testable implications of the second
DAG are that all pairs of variables should be associated, before conditioning on anything, but that D &gt;and M should be independent after conditioning on A. So the only implication that differs between &gt;these DAGs is the last one: D ⊥ M|A.</p>
</blockquote>
<p>In order to test this we need a statistical model. Here we build it. First the stan data</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="the-many-variables-the-spurious-waffles.html#cb96-1" aria-hidden="true"></a>dat_multiple &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">N=</span><span class="kw">NROW</span>(d),</span>
<span id="cb96-2"><a href="the-many-variables-the-spurious-waffles.html#cb96-2" aria-hidden="true"></a>                     <span class="dt">A =</span> d<span class="op">$</span>A,</span>
<span id="cb96-3"><a href="the-many-variables-the-spurious-waffles.html#cb96-3" aria-hidden="true"></a>                     <span class="dt">M =</span> d<span class="op">$</span>M,</span>
<span id="cb96-4"><a href="the-many-variables-the-spurious-waffles.html#cb96-4" aria-hidden="true"></a>                     <span class="dt">D =</span> d<span class="op">$</span>D)</span></code></pre></div>
<p>Stan model is going to be really similar to polynomial models. The only difference will be that we are not going to use the same variable again and again. Rather, our <span class="math inline">\(\beta\)</span>s will be associated with differen variables.</p>
<p>Contrary to previous models we created, this time I will write an additional block which draws the predictions from the posterior.</p>
<pre class="stan"><code>data{
  int&lt;lower=1&gt; N;
  vector[N] A;
  vector[N] M;
  vector[N] D;
}
parameters{
  real alpha;
  real beta_A;
  real beta_M;
  real&lt;lower=0&gt; sigma;
}
transformed parameters{
  vector[N] mu = alpha + beta_A * A + beta_M * M;
}
model{
  D ~ normal(mu, sigma);
  alpha ~ normal(0, 0.2);
  beta_M ~ normal(0, 0.5);
  beta_M ~ normal(0, 0.5);
  sigma ~ exponential(1);
}
generated quantities{
  vector[N] yhat;
  for (i in 1:N) yhat[i] = normal_rng(mu[i], sigma);
}
</code></pre>
<p>The generated quantities block is designed for that purpose. Once you have the model, you can make stan all the manual work do for you.</p>
<p>Basically what we told the Golem is, “hey, please create a vector of size N. For each row ranging from 1 to N, simulate from a normal distribution. In order to simulate from normal distribution you’ll naturally need a mean and standard deviation. Take each row of mu as mean and use sigma and standard deviation”</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="the-many-variables-the-spurious-waffles.html#cb98-1" aria-hidden="true"></a><span class="co">#Sampling</span></span>
<span id="cb98-2"><a href="the-many-variables-the-spurious-waffles.html#cb98-2" aria-hidden="true"></a>fit_multiple &lt;-<span class="st"> </span><span class="kw">sampling</span>(model_multiple.stan,</span>
<span id="cb98-3"><a href="the-many-variables-the-spurious-waffles.html#cb98-3" aria-hidden="true"></a>                         dat_multiple,</span>
<span id="cb98-4"><a href="the-many-variables-the-spurious-waffles.html#cb98-4" aria-hidden="true"></a>                         <span class="dt">iter=</span><span class="dv">1000</span>,</span>
<span id="cb98-5"><a href="the-many-variables-the-spurious-waffles.html#cb98-5" aria-hidden="true"></a>                         <span class="dt">chains=</span><span class="dv">2</span>,</span>
<span id="cb98-6"><a href="the-many-variables-the-spurious-waffles.html#cb98-6" aria-hidden="true"></a>                         <span class="dt">cores=</span><span class="dv">4</span>)</span></code></pre></div>
<p>Coefficient for A in single predictor model</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="the-many-variables-the-spurious-waffles.html#cb99-1" aria-hidden="true"></a><span class="kw">print</span>(fit_<span class="dv">5</span>_<span class="dv">1</span>_a, <span class="dt">pars=</span><span class="st">&quot;beta&quot;</span>)</span></code></pre></div>
<pre><code>## Inference for Stan model: stan-1982640c4519.
## 2 chains, each with iter=1000; warmup=500; thin=1; 
## post-warmup draws per chain=500, total post-warmup draws=1000.
## 
##       mean se_mean   sd  2.5%   25%   50%   75% 97.5% n_eff Rhat
## beta -0.56       0 0.11 -0.78 -0.64 -0.56 -0.49 -0.34  1027    1
## 
## Samples were drawn using NUTS(diag_e) at Sat Jul 17 13:47:56 2021.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<p>coefficient for M in single predictor model</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="the-many-variables-the-spurious-waffles.html#cb101-1" aria-hidden="true"></a><span class="kw">print</span>(fit_<span class="dv">5</span>_<span class="dv">1</span>_b, <span class="dt">pars=</span><span class="st">&quot;beta&quot;</span>)</span></code></pre></div>
<pre><code>## Inference for Stan model: stan-1982640c4519.
## 2 chains, each with iter=1000; warmup=500; thin=1; 
## post-warmup draws per chain=500, total post-warmup draws=1000.
## 
##      mean se_mean   sd 2.5%  25%  50%  75% 97.5% n_eff Rhat
## beta 0.35       0 0.13 0.09 0.26 0.35 0.44  0.58   801    1
## 
## Samples were drawn using NUTS(diag_e) at Sat Jul 17 13:48:01 2021.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="the-many-variables-the-spurious-waffles.html#cb103-1" aria-hidden="true"></a><span class="kw">print</span>(fit_multiple, <span class="dt">pars=</span><span class="kw">c</span>(<span class="st">&quot;beta_A&quot;</span>, <span class="st">&quot;beta_M&quot;</span>))</span></code></pre></div>
<pre><code>## Inference for Stan model: stan-1982d2a88ab.
## 2 chains, each with iter=1000; warmup=500; thin=1; 
## post-warmup draws per chain=500, total post-warmup draws=1000.
## 
##         mean se_mean   sd  2.5%   25%   50%   75% 97.5% n_eff Rhat
## beta_A -0.67    0.01 0.17 -1.00 -0.77 -0.66 -0.55 -0.36   629    1
## beta_M -0.10    0.01 0.15 -0.42 -0.20 -0.10  0.00  0.18   575    1
## 
## Samples were drawn using NUTS(diag_e) at Sat Jul 17 13:48:07 2021.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<p>Look how coefficient for M wildy reduced. More importantly the credible interval is containing the zero now. So, the testable implication of the second was confirmed. Since the first one didn’t have this implication, it’s out.</p>
<p>In the section where McElreath shows us how to dig deeper the multivariate posterior, he also spent time on predictor residual plots. Here I will skip that. Maybe I’ll add it when I am done with this project. For the time being I will only do posterior predictions and counterfactual plots</p>
<div id="posterior-prediction-plots" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Posterior Prediction Plots</h3>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="the-many-variables-the-spurious-waffles.html#cb105-1" aria-hidden="true"></a>p_dat_mult &lt;-<span class="st"> </span></span>
<span id="cb105-2"><a href="the-many-variables-the-spurious-waffles.html#cb105-2" aria-hidden="true"></a><span class="st">  </span>fit_multiple<span class="op">%&gt;%</span></span>
<span id="cb105-3"><a href="the-many-variables-the-spurious-waffles.html#cb105-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">gather_draws</span>(mu[i]) <span class="op">%&gt;%</span></span>
<span id="cb105-4"><a href="the-many-variables-the-spurious-waffles.html#cb105-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mean_qi</span>() <span class="op">%&gt;%</span></span>
<span id="cb105-5"><a href="the-many-variables-the-spurious-waffles.html#cb105-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">mu =</span> .value)</span>
<span id="cb105-6"><a href="the-many-variables-the-spurious-waffles.html#cb105-6" aria-hidden="true"></a></span>
<span id="cb105-7"><a href="the-many-variables-the-spurious-waffles.html#cb105-7" aria-hidden="true"></a>yhat &lt;-<span class="st"> </span></span>
<span id="cb105-8"><a href="the-many-variables-the-spurious-waffles.html#cb105-8" aria-hidden="true"></a><span class="st">  </span>fit_multiple<span class="op">%&gt;%</span><span class="kw">gather_draws</span>(yhat[i]) <span class="op">%&gt;%</span></span>
<span id="cb105-9"><a href="the-many-variables-the-spurious-waffles.html#cb105-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">mean_qi</span>() <span class="op">%&gt;%</span></span>
<span id="cb105-10"><a href="the-many-variables-the-spurious-waffles.html#cb105-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">yhat =</span> .value)</span>
<span id="cb105-11"><a href="the-many-variables-the-spurious-waffles.html#cb105-11" aria-hidden="true"></a></span>
<span id="cb105-12"><a href="the-many-variables-the-spurious-waffles.html#cb105-12" aria-hidden="true"></a>p_dat_mult<span class="op">$</span>observed &lt;-<span class="st"> </span>d<span class="op">$</span>D</span>
<span id="cb105-13"><a href="the-many-variables-the-spurious-waffles.html#cb105-13" aria-hidden="true"></a>p_dat_mult<span class="op">$</span>yhat &lt;-<span class="st"> </span>yhat<span class="op">$</span>yhat</span>
<span id="cb105-14"><a href="the-many-variables-the-spurious-waffles.html#cb105-14" aria-hidden="true"></a></span>
<span id="cb105-15"><a href="the-many-variables-the-spurious-waffles.html#cb105-15" aria-hidden="true"></a><span class="kw">ggplot</span>(p_dat_mult, <span class="kw">aes</span>(<span class="dt">x=</span>observed, <span class="dt">y=</span>yhat, </span>
<span id="cb105-16"><a href="the-many-variables-the-spurious-waffles.html#cb105-16" aria-hidden="true"></a>                         <span class="dt">ymin =</span> .lower, <span class="dt">ymax =</span> .upper)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb105-17"><a href="the-many-variables-the-spurious-waffles.html#cb105-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb105-18"><a href="the-many-variables-the-spurious-waffles.html#cb105-18" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_pointrange</span>() <span class="op">+</span></span>
<span id="cb105-19"><a href="the-many-variables-the-spurious-waffles.html#cb105-19" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">linetype =</span> <span class="st">&#39;dashed&#39;</span>) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-82-1.png" width="100%" /></p>
</div>
<div id="counterfactual-plots" class="section level3" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Counterfactual Plots</h3>
<p>Now we come to a specific point where we have to fit 2 models at the same time inside one stan file. First of all, is it possible? Well, if it’s possible for BRMS, then it should be possible for us too. For this task it’s not super necessary to learn from BRMS because this time the task is relatively easy. All we have to do is specifying parameters in a naming convention that when we are using them in different calculations, we should know which parameter is from which model. The rest is merging two models that we already fit.</p>
<p>However, since I want to encourage the readers to get the habit of learning from BRMS when in doubt, I will show you how BRMS constructs it.</p>
<p>let’s fit the brms model</p>
<p>Again, I quickly copy paste it from Solomon’s book.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="the-many-variables-the-spurious-waffles.html#cb106-1" aria-hidden="true"></a>d_model &lt;-<span class="st"> </span><span class="kw">bf</span>(D <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>A <span class="op">+</span><span class="st"> </span>M)</span>
<span id="cb106-2"><a href="the-many-variables-the-spurious-waffles.html#cb106-2" aria-hidden="true"></a>m_model &lt;-<span class="st"> </span><span class="kw">bf</span>(M <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>A)</span>
<span id="cb106-3"><a href="the-many-variables-the-spurious-waffles.html#cb106-3" aria-hidden="true"></a></span>
<span id="cb106-4"><a href="the-many-variables-the-spurious-waffles.html#cb106-4" aria-hidden="true"></a></span>
<span id="cb106-5"><a href="the-many-variables-the-spurious-waffles.html#cb106-5" aria-hidden="true"></a><span class="co">#model</span></span>
<span id="cb106-6"><a href="the-many-variables-the-spurious-waffles.html#cb106-6" aria-hidden="true"></a>b5<span class="fl">.3</span>_A &lt;-</span>
<span id="cb106-7"><a href="the-many-variables-the-spurious-waffles.html#cb106-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </span>
<span id="cb106-8"><a href="the-many-variables-the-spurious-waffles.html#cb106-8" aria-hidden="true"></a>      <span class="dt">family =</span> gaussian,</span>
<span id="cb106-9"><a href="the-many-variables-the-spurious-waffles.html#cb106-9" aria-hidden="true"></a>      d_model <span class="op">+</span><span class="st"> </span>m_model <span class="op">+</span><span class="st"> </span><span class="kw">set_rescor</span>(<span class="ot">FALSE</span>),</span>
<span id="cb106-10"><a href="the-many-variables-the-spurious-waffles.html#cb106-10" aria-hidden="true"></a>      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept, <span class="dt">resp =</span> D),</span>
<span id="cb106-11"><a href="the-many-variables-the-spurious-waffles.html#cb106-11" aria-hidden="true"></a>                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b, <span class="dt">resp =</span> D),</span>
<span id="cb106-12"><a href="the-many-variables-the-spurious-waffles.html#cb106-12" aria-hidden="true"></a>                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma, <span class="dt">resp =</span> D),</span>
<span id="cb106-13"><a href="the-many-variables-the-spurious-waffles.html#cb106-13" aria-hidden="true"></a>                </span>
<span id="cb106-14"><a href="the-many-variables-the-spurious-waffles.html#cb106-14" aria-hidden="true"></a>                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept, <span class="dt">resp =</span> M),</span>
<span id="cb106-15"><a href="the-many-variables-the-spurious-waffles.html#cb106-15" aria-hidden="true"></a>                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b, <span class="dt">resp =</span> M),</span>
<span id="cb106-16"><a href="the-many-variables-the-spurious-waffles.html#cb106-16" aria-hidden="true"></a>                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma, <span class="dt">resp =</span> M)),</span>
<span id="cb106-17"><a href="the-many-variables-the-spurious-waffles.html#cb106-17" aria-hidden="true"></a>      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</span>
<span id="cb106-18"><a href="the-many-variables-the-spurious-waffles.html#cb106-18" aria-hidden="true"></a>      <span class="dt">seed =</span> <span class="dv">5</span>)</span></code></pre></div>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="the-many-variables-the-spurious-waffles.html#cb107-1" aria-hidden="true"></a><span class="kw">print</span>(<span class="kw">stancode</span>(b5<span class="fl">.3</span>_A))</span></code></pre></div>
<pre><code>## // generated with brms 2.15.0
## functions {
## }
## data {
##   int&lt;lower=1&gt; N;  // total number of observations
##   int&lt;lower=1&gt; N_D;  // number of observations
##   vector[N_D] Y_D;  // response variable
##   int&lt;lower=1&gt; K_D;  // number of population-level effects
##   matrix[N_D, K_D] X_D;  // population-level design matrix
##   int&lt;lower=1&gt; N_M;  // number of observations
##   vector[N_M] Y_M;  // response variable
##   int&lt;lower=1&gt; K_M;  // number of population-level effects
##   matrix[N_M, K_M] X_M;  // population-level design matrix
##   int prior_only;  // should the likelihood be ignored?
## }
## transformed data {
##   int Kc_D = K_D - 1;
##   matrix[N_D, Kc_D] Xc_D;  // centered version of X_D without an intercept
##   vector[Kc_D] means_X_D;  // column means of X_D before centering
##   int Kc_M = K_M - 1;
##   matrix[N_M, Kc_M] Xc_M;  // centered version of X_M without an intercept
##   vector[Kc_M] means_X_M;  // column means of X_M before centering
##   for (i in 2:K_D) {
##     means_X_D[i - 1] = mean(X_D[, i]);
##     Xc_D[, i - 1] = X_D[, i] - means_X_D[i - 1];
##   }
##   for (i in 2:K_M) {
##     means_X_M[i - 1] = mean(X_M[, i]);
##     Xc_M[, i - 1] = X_M[, i] - means_X_M[i - 1];
##   }
## }
## parameters {
##   vector[Kc_D] b_D;  // population-level effects
##   real Intercept_D;  // temporary intercept for centered predictors
##   real&lt;lower=0&gt; sigma_D;  // residual SD
##   vector[Kc_M] b_M;  // population-level effects
##   real Intercept_M;  // temporary intercept for centered predictors
##   real&lt;lower=0&gt; sigma_M;  // residual SD
## }
## transformed parameters {
## }
## model {
##   // likelihood including constants
##   if (!prior_only) {
##     target += normal_id_glm_lpdf(Y_D | Xc_D, Intercept_D, b_D, sigma_D);
##     target += normal_id_glm_lpdf(Y_M | Xc_M, Intercept_M, b_M, sigma_M);
##   }
##   // priors including constants
##   target += normal_lpdf(b_D | 0, 0.5);
##   target += normal_lpdf(Intercept_D | 0, 0.2);
##   target += exponential_lpdf(sigma_D | 1);
##   target += normal_lpdf(b_M | 0, 0.5);
##   target += normal_lpdf(Intercept_M | 0, 0.2);
##   target += exponential_lpdf(sigma_M | 1);
## }
## generated quantities {
##   // actual population-level intercept
##   real b_D_Intercept = Intercept_D - dot_product(means_X_D, b_D);
##   // actual population-level intercept
##   real b_M_Intercept = Intercept_M - dot_product(means_X_M, b_M);
## }</code></pre>
<p>It’s long but pretty simple. If you look at the data block you can see that brms used compact notation. Solid way of declaring the data but not the only way. If you are already a person with advanced statistics literacy you may find it comfortable this way too. But for me, I prefer writing it explicitly.</p>
<p>What I want you to see whether is there something abnormal in the model and parameters block. Thankfully no, it’s just parameters piled up on top of each other. So, if this is the way to go, I believe we can continue with the simpler approach we have.</p>
<pre class="stan"><code>data {
  int&lt;lower=1&gt; N;
  vector[N] A;
  vector[N] M;
  vector[N] D;
}
parameters{
//First model
  real alpha_model_1;
  real beta_A_model_1;
  real beta_M_model_1;
  real&lt;lower=0&gt; sigma_model_1;
//betas
  real alpha_model_2;
  real beta_A_model_2;
  real&lt;lower=0&gt; sigma_model_2;
}
transformed parameters {
  // mu of first model
  vector[N] mu_model_1 = alpha_model_1 + beta_A_model_1 * A + beta_M_model_1 * M;
  // mu of second model
  vector[N] mu_model_2 = alpha_model_2 + beta_A_model_2 * A;
}
model {
  // modelling the response and setting priors for the params in the first model
  D ~ normal(mu_model_1, sigma_model_1);
  alpha_model_1~normal(0, 0.2);
  beta_A_model_1 ~ normal(0, 0.5);
  beta_M_model_1 ~ normal(0, 0.5);
  sigma_model_1 ~ exponential(1);
  // modelling the response and setting priors for the params in the second model
  M ~normal(mu_model_2, sigma_model_2);
  alpha_model_2 ~ normal(0, 0.2);
  beta_A_model_2 ~ normal(0, 0.5);
}

generated quantities {
  vector[N] yhat_model_1;
  vector[N] yhat_model_2;
  for (i in 1:N)
  yhat_model_1[i] = normal_rng(mu_model_1[i], sigma_model_1);
  for (i in 1:N)
  yhat_model_2[i] = normal_rng(mu_model_2[i], sigma_model_2);
}
</code></pre>
<p>The generated quantities block above is completely unnecessary for the following example</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="the-many-variables-the-spurious-waffles.html#cb110-1" aria-hidden="true"></a>fit_cf &lt;-<span class="st"> </span><span class="kw">sampling</span>(model_counterfactual.stan,</span>
<span id="cb110-2"><a href="the-many-variables-the-spurious-waffles.html#cb110-2" aria-hidden="true"></a>                    dat_multiple,</span>
<span id="cb110-3"><a href="the-many-variables-the-spurious-waffles.html#cb110-3" aria-hidden="true"></a>                    <span class="dt">chains=</span><span class="dv">2</span>,</span>
<span id="cb110-4"><a href="the-many-variables-the-spurious-waffles.html#cb110-4" aria-hidden="true"></a>                    <span class="dt">cores=</span><span class="dv">4</span>,</span>
<span id="cb110-5"><a href="the-many-variables-the-spurious-waffles.html#cb110-5" aria-hidden="true"></a>                    <span class="dt">iter=</span><span class="dv">1000</span>)</span></code></pre></div>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="the-many-variables-the-spurious-waffles.html#cb111-1" aria-hidden="true"></a>posterior_cf &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(fit_cf)</span>
<span id="cb111-2"><a href="the-many-variables-the-spurious-waffles.html#cb111-2" aria-hidden="true"></a></span>
<span id="cb111-3"><a href="the-many-variables-the-spurious-waffles.html#cb111-3" aria-hidden="true"></a><span class="co"># new data for intervention</span></span>
<span id="cb111-4"><a href="the-many-variables-the-spurious-waffles.html#cb111-4" aria-hidden="true"></a>A_manipulated &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">-2</span>, <span class="dt">to =</span> <span class="dv">2</span>, <span class="dt">length.out =</span> <span class="dv">30</span>)</span>
<span id="cb111-5"><a href="the-many-variables-the-spurious-waffles.html#cb111-5" aria-hidden="true"></a><span class="co"># intervening A -&gt; M</span></span>
<span id="cb111-6"><a href="the-many-variables-the-spurious-waffles.html#cb111-6" aria-hidden="true"></a><span class="co"># function to simulate the mean</span></span>
<span id="cb111-7"><a href="the-many-variables-the-spurious-waffles.html#cb111-7" aria-hidden="true"></a>simulate_mu_A_M &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">with</span>(posterior_cf, alpha_model_<span class="dv">2</span> <span class="op">+</span><span class="st"> </span>beta_A_model_<span class="dv">2</span> <span class="op">*</span>x)</span>
<span id="cb111-8"><a href="the-many-variables-the-spurious-waffles.html#cb111-8" aria-hidden="true"></a></span>
<span id="cb111-9"><a href="the-many-variables-the-spurious-waffles.html#cb111-9" aria-hidden="true"></a><span class="co"># Function to simulate predictions</span></span>
<span id="cb111-10"><a href="the-many-variables-the-spurious-waffles.html#cb111-10" aria-hidden="true"></a>sim_prediction_A_M &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">rnorm</span>(<span class="dv">10000</span>,</span>
<span id="cb111-11"><a href="the-many-variables-the-spurious-waffles.html#cb111-11" aria-hidden="true"></a>                                    <span class="dt">mean =</span><span class="kw">with</span>(posterior_cf, alpha_model_<span class="dv">2</span> <span class="op">+</span><span class="st"> </span>beta_A_model_<span class="dv">2</span> <span class="op">*</span>x),</span>
<span id="cb111-12"><a href="the-many-variables-the-spurious-waffles.html#cb111-12" aria-hidden="true"></a>                                    <span class="dt">sd =</span> posterior_cf<span class="op">$</span>sigma_model_<span class="dv">2</span>)</span></code></pre></div>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="the-many-variables-the-spurious-waffles.html#cb112-1" aria-hidden="true"></a><span class="kw">sapply</span>(A_manipulated , sim_prediction_A_M) <span class="op">%&gt;%</span></span>
<span id="cb112-2"><a href="the-many-variables-the-spurious-waffles.html#cb112-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb112-3"><a href="the-many-variables-the-spurious-waffles.html#cb112-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename_all</span>(<span class="cf">function</span>(x) A_manipulated) <span class="op">%&gt;%</span></span>
<span id="cb112-4"><a href="the-many-variables-the-spurious-waffles.html#cb112-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iteration =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span></span>
<span id="cb112-5"><a href="the-many-variables-the-spurious-waffles.html#cb112-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">gather</span>(A_manipulated, yhat, <span class="op">-</span>iteration) <span class="op">%&gt;%</span></span>
<span id="cb112-6"><a href="the-many-variables-the-spurious-waffles.html#cb112-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(A_manipulated) <span class="op">%&gt;%</span></span>
<span id="cb112-7"><a href="the-many-variables-the-spurious-waffles.html#cb112-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hpdi_l =</span> HDInterval<span class="op">::</span><span class="kw">hdi</span>(yhat, <span class="dt">credMass=</span><span class="fl">0.8</span>)[<span class="dv">1</span>],</span>
<span id="cb112-8"><a href="the-many-variables-the-spurious-waffles.html#cb112-8" aria-hidden="true"></a>         <span class="dt">hpdi_h =</span> HDInterval<span class="op">::</span><span class="kw">hdi</span>(yhat, <span class="dt">credMass=</span><span class="fl">0.8</span>)[<span class="dv">2</span>],</span>
<span id="cb112-9"><a href="the-many-variables-the-spurious-waffles.html#cb112-9" aria-hidden="true"></a>         <span class="dt">yhat_mu =</span> <span class="kw">mean</span>(yhat))<span class="op">%&gt;%</span></span>
<span id="cb112-10"><a href="the-many-variables-the-spurious-waffles.html#cb112-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">ungroup</span>()<span class="op">%&gt;%</span></span>
<span id="cb112-11"><a href="the-many-variables-the-spurious-waffles.html#cb112-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">A_manipulated =</span> <span class="kw">as.numeric</span>(A_manipulated),</span>
<span id="cb112-12"><a href="the-many-variables-the-spurious-waffles.html#cb112-12" aria-hidden="true"></a>         <span class="dt">yhat =</span> <span class="kw">as.numeric</span>(yhat),</span>
<span id="cb112-13"><a href="the-many-variables-the-spurious-waffles.html#cb112-13" aria-hidden="true"></a>         <span class="dt">yhat_mu =</span> <span class="kw">as.numeric</span>(yhat_mu))<span class="op">%&gt;%</span></span>
<span id="cb112-14"><a href="the-many-variables-the-spurious-waffles.html#cb112-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb112-15"><a href="the-many-variables-the-spurious-waffles.html#cb112-15" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">round</span>(A_manipulated, <span class="dv">2</span>),</span>
<span id="cb112-16"><a href="the-many-variables-the-spurious-waffles.html#cb112-16" aria-hidden="true"></a>                  <span class="dt">y=</span>yhat_mu, <span class="dt">ymin=</span>hpdi_l, <span class="dt">ymax=</span>hpdi_h),</span>
<span id="cb112-17"><a href="the-many-variables-the-spurious-waffles.html#cb112-17" aria-hidden="true"></a>              <span class="dt">alpha=</span><span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb112-18"><a href="the-many-variables-the-spurious-waffles.html#cb112-18" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>A_manipulated, <span class="dt">y=</span>yhat_mu),</span>
<span id="cb112-19"><a href="the-many-variables-the-spurious-waffles.html#cb112-19" aria-hidden="true"></a>            <span class="dt">color=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb112-20"><a href="the-many-variables-the-spurious-waffles.html#cb112-20" aria-hidden="true"></a>            <span class="dt">size=</span><span class="fl">1.5</span>) <span class="op">+</span></span>
<span id="cb112-21"><a href="the-many-variables-the-spurious-waffles.html#cb112-21" aria-hidden="true"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Manipulated A&quot;</span>) <span class="op">+</span></span>
<span id="cb112-22"><a href="the-many-variables-the-spurious-waffles.html#cb112-22" aria-hidden="true"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Counterfactual M&quot;</span>)<span class="op">+</span></span>
<span id="cb112-23"><a href="the-many-variables-the-spurious-waffles.html#cb112-23" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Total counterfactual effect of A on M&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-88-1.png" width="100%" /></p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="the-many-variables-the-spurious-waffles.html#cb113-1" aria-hidden="true"></a>sim_prediction_A_D &lt;-<span class="st"> </span><span class="cf">function</span>(x, x2) <span class="kw">rnorm</span>(<span class="dv">10000</span>,</span>
<span id="cb113-2"><a href="the-many-variables-the-spurious-waffles.html#cb113-2" aria-hidden="true"></a>                                        <span class="dt">mean =</span><span class="kw">with</span>(posterior_cf, alpha_model_<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>beta_A_model_<span class="dv">1</span> <span class="op">*</span>x <span class="op">+</span><span class="st"> </span>beta_M_model_<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>x2),</span>
<span id="cb113-3"><a href="the-many-variables-the-spurious-waffles.html#cb113-3" aria-hidden="true"></a>                                        <span class="dt">sd =</span> posterior_cf<span class="op">$</span>sigma_model_<span class="dv">1</span>)</span>
<span id="cb113-4"><a href="the-many-variables-the-spurious-waffles.html#cb113-4" aria-hidden="true"></a></span>
<span id="cb113-5"><a href="the-many-variables-the-spurious-waffles.html#cb113-5" aria-hidden="true"></a></span>
<span id="cb113-6"><a href="the-many-variables-the-spurious-waffles.html#cb113-6" aria-hidden="true"></a></span>
<span id="cb113-7"><a href="the-many-variables-the-spurious-waffles.html#cb113-7" aria-hidden="true"></a><span class="kw">sapply</span>(A_manipulated , sim_prediction_A_D, <span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb113-8"><a href="the-many-variables-the-spurious-waffles.html#cb113-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb113-9"><a href="the-many-variables-the-spurious-waffles.html#cb113-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename_all</span>(<span class="cf">function</span>(x) A_manipulated) <span class="op">%&gt;%</span></span>
<span id="cb113-10"><a href="the-many-variables-the-spurious-waffles.html#cb113-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iteration =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span></span>
<span id="cb113-11"><a href="the-many-variables-the-spurious-waffles.html#cb113-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">gather</span>(A_manipulated, yhat, <span class="op">-</span>iteration) <span class="op">%&gt;%</span></span>
<span id="cb113-12"><a href="the-many-variables-the-spurious-waffles.html#cb113-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(A_manipulated) <span class="op">%&gt;%</span></span>
<span id="cb113-13"><a href="the-many-variables-the-spurious-waffles.html#cb113-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hpdi_l =</span> HDInterval<span class="op">::</span><span class="kw">hdi</span>(yhat, <span class="dt">credMass=</span><span class="fl">0.8</span>)[<span class="dv">1</span>],</span>
<span id="cb113-14"><a href="the-many-variables-the-spurious-waffles.html#cb113-14" aria-hidden="true"></a>         <span class="dt">hpdi_h =</span> HDInterval<span class="op">::</span><span class="kw">hdi</span>(yhat, <span class="dt">credMass=</span><span class="fl">0.8</span>)[<span class="dv">2</span>],</span>
<span id="cb113-15"><a href="the-many-variables-the-spurious-waffles.html#cb113-15" aria-hidden="true"></a>         <span class="dt">yhat_mu =</span> <span class="kw">mean</span>(yhat))<span class="op">%&gt;%</span></span>
<span id="cb113-16"><a href="the-many-variables-the-spurious-waffles.html#cb113-16" aria-hidden="true"></a><span class="st">  </span><span class="kw">ungroup</span>()<span class="op">%&gt;%</span></span>
<span id="cb113-17"><a href="the-many-variables-the-spurious-waffles.html#cb113-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">A_manipulated =</span> <span class="kw">as.numeric</span>(A_manipulated),</span>
<span id="cb113-18"><a href="the-many-variables-the-spurious-waffles.html#cb113-18" aria-hidden="true"></a>         <span class="dt">yhat =</span> <span class="kw">as.numeric</span>(yhat),</span>
<span id="cb113-19"><a href="the-many-variables-the-spurious-waffles.html#cb113-19" aria-hidden="true"></a>         <span class="dt">yhat_mu =</span> <span class="kw">as.numeric</span>(yhat_mu))<span class="op">%&gt;%</span></span>
<span id="cb113-20"><a href="the-many-variables-the-spurious-waffles.html#cb113-20" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb113-21"><a href="the-many-variables-the-spurious-waffles.html#cb113-21" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">round</span>(A_manipulated, <span class="dv">2</span>),</span>
<span id="cb113-22"><a href="the-many-variables-the-spurious-waffles.html#cb113-22" aria-hidden="true"></a>                  <span class="dt">y=</span>yhat_mu, <span class="dt">ymin=</span>hpdi_l,</span>
<span id="cb113-23"><a href="the-many-variables-the-spurious-waffles.html#cb113-23" aria-hidden="true"></a>                  <span class="dt">ymax=</span>hpdi_h), <span class="dt">alpha=</span><span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb113-24"><a href="the-many-variables-the-spurious-waffles.html#cb113-24" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>A_manipulated, <span class="dt">y=</span>yhat_mu),</span>
<span id="cb113-25"><a href="the-many-variables-the-spurious-waffles.html#cb113-25" aria-hidden="true"></a>            <span class="dt">color=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb113-26"><a href="the-many-variables-the-spurious-waffles.html#cb113-26" aria-hidden="true"></a>            <span class="dt">size=</span><span class="fl">1.5</span>) <span class="op">+</span></span>
<span id="cb113-27"><a href="the-many-variables-the-spurious-waffles.html#cb113-27" aria-hidden="true"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Manipulated A&quot;</span>) <span class="op">+</span></span>
<span id="cb113-28"><a href="the-many-variables-the-spurious-waffles.html#cb113-28" aria-hidden="true"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Counterfactual D&quot;</span>) <span class="op">+</span></span>
<span id="cb113-29"><a href="the-many-variables-the-spurious-waffles.html#cb113-29" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Counterfactual Effect of A on D&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-89-1.png" width="100%" /></p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="the-many-variables-the-spurious-waffles.html#cb114-1" aria-hidden="true"></a><span class="co"># Manipulated M</span></span>
<span id="cb114-2"><a href="the-many-variables-the-spurious-waffles.html#cb114-2" aria-hidden="true"></a>M_manipulated &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">M_manipulated =</span> <span class="kw">seq</span>(<span class="dt">from=</span><span class="op">-</span><span class="dv">2</span>, <span class="dt">to=</span><span class="dv">2</span>, <span class="dt">length.out =</span> <span class="dv">30</span>),</span>
<span id="cb114-3"><a href="the-many-variables-the-spurious-waffles.html#cb114-3" aria-hidden="true"></a>                      <span class="dt">A =</span> <span class="kw">seq</span>(<span class="dt">from=</span><span class="dv">0</span>, <span class="dt">to=</span><span class="dv">0</span>, <span class="dt">length.out =</span> <span class="dv">30</span>))</span>
<span id="cb114-4"><a href="the-many-variables-the-spurious-waffles.html#cb114-4" aria-hidden="true"></a></span>
<span id="cb114-5"><a href="the-many-variables-the-spurious-waffles.html#cb114-5" aria-hidden="true"></a></span>
<span id="cb114-6"><a href="the-many-variables-the-spurious-waffles.html#cb114-6" aria-hidden="true"></a><span class="co"># Simulate predictions for M-&gt;D</span></span>
<span id="cb114-7"><a href="the-many-variables-the-spurious-waffles.html#cb114-7" aria-hidden="true"></a>sim_prediction_M_D &lt;-<span class="st"> </span><span class="cf">function</span>(x, x_constant) <span class="kw">rnorm</span>(<span class="dv">10000</span>, </span>
<span id="cb114-8"><a href="the-many-variables-the-spurious-waffles.html#cb114-8" aria-hidden="true"></a>                                            <span class="dt">mean =</span> <span class="kw">with</span>(posterior_cf, alpha_model_<span class="dv">1</span>  <span class="op">+</span><span class="st"> </span>beta_M_model_<span class="dv">1</span> <span class="op">*</span>x <span class="op">+</span><span class="st"> </span>beta_A_model_<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>x_constant),</span>
<span id="cb114-9"><a href="the-many-variables-the-spurious-waffles.html#cb114-9" aria-hidden="true"></a>                                            <span class="dt">sd=</span>posterior_cf<span class="op">$</span>sigma_model_<span class="dv">1</span>)</span>
<span id="cb114-10"><a href="the-many-variables-the-spurious-waffles.html#cb114-10" aria-hidden="true"></a></span>
<span id="cb114-11"><a href="the-many-variables-the-spurious-waffles.html#cb114-11" aria-hidden="true"></a></span>
<span id="cb114-12"><a href="the-many-variables-the-spurious-waffles.html#cb114-12" aria-hidden="true"></a><span class="kw">sapply</span>(M_manipulated<span class="op">$</span>M_manipulated, sim_prediction_M_D, <span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb114-13"><a href="the-many-variables-the-spurious-waffles.html#cb114-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb114-14"><a href="the-many-variables-the-spurious-waffles.html#cb114-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename_all</span>(<span class="cf">function</span>(x) M_manipulated<span class="op">$</span>M_manipulated) <span class="op">%&gt;%</span></span>
<span id="cb114-15"><a href="the-many-variables-the-spurious-waffles.html#cb114-15" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iteration =</span>  <span class="kw">row_number</span>()) <span class="op">%&gt;%</span></span>
<span id="cb114-16"><a href="the-many-variables-the-spurious-waffles.html#cb114-16" aria-hidden="true"></a><span class="st">  </span><span class="kw">gather</span>(M, D, <span class="op">-</span>iteration) <span class="op">%&gt;%</span></span>
<span id="cb114-17"><a href="the-many-variables-the-spurious-waffles.html#cb114-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(M) <span class="op">%&gt;%</span></span>
<span id="cb114-18"><a href="the-many-variables-the-spurious-waffles.html#cb114-18" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pi_l =</span> rethinking<span class="op">::</span><span class="kw">PI</span>(D, <span class="dt">prob=</span><span class="fl">0.89</span>)[<span class="dv">1</span>],</span>
<span id="cb114-19"><a href="the-many-variables-the-spurious-waffles.html#cb114-19" aria-hidden="true"></a>         <span class="dt">pi_h =</span> rethinking<span class="op">::</span><span class="kw">PI</span>(D, <span class="dt">prob=</span><span class="fl">0.89</span>)[<span class="dv">2</span>],</span>
<span id="cb114-20"><a href="the-many-variables-the-spurious-waffles.html#cb114-20" aria-hidden="true"></a>         <span class="dt">yhat_mu =</span> <span class="kw">mean</span>(D))<span class="op">%&gt;%</span></span>
<span id="cb114-21"><a href="the-many-variables-the-spurious-waffles.html#cb114-21" aria-hidden="true"></a><span class="st">  </span><span class="kw">ungroup</span>()<span class="op">%&gt;%</span></span>
<span id="cb114-22"><a href="the-many-variables-the-spurious-waffles.html#cb114-22" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">M=</span><span class="kw">as.numeric</span>(M),</span>
<span id="cb114-23"><a href="the-many-variables-the-spurious-waffles.html#cb114-23" aria-hidden="true"></a>         <span class="dt">D=</span><span class="kw">as.numeric</span>(D),</span>
<span id="cb114-24"><a href="the-many-variables-the-spurious-waffles.html#cb114-24" aria-hidden="true"></a>         <span class="dt">yhat_mu =</span> <span class="kw">as.numeric</span>(yhat_mu)) <span class="op">%&gt;%</span></span>
<span id="cb114-25"><a href="the-many-variables-the-spurious-waffles.html#cb114-25" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb114-26"><a href="the-many-variables-the-spurious-waffles.html#cb114-26" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x=</span>M, <span class="dt">y=</span>yhat_mu, <span class="dt">ymin=</span>pi_l, <span class="dt">ymax=</span>pi_h), <span class="dt">alpha=</span><span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb114-27"><a href="the-many-variables-the-spurious-waffles.html#cb114-27" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>M, <span class="dt">y=</span>yhat_mu), <span class="dt">color=</span><span class="st">&quot;black&quot;</span>, <span class="dt">size=</span><span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-90-1.png" width="100%" /></p>
</div>
</div>
<div id="masked-relationship" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Masked Relationship</h2>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="the-many-variables-the-spurious-waffles.html#cb115-1" aria-hidden="true"></a><span class="kw">data</span>(milk)</span>
<span id="cb115-2"><a href="the-many-variables-the-spurious-waffles.html#cb115-2" aria-hidden="true"></a>d &lt;-<span class="st"> </span>milk</span>
<span id="cb115-3"><a href="the-many-variables-the-spurious-waffles.html#cb115-3" aria-hidden="true"></a><span class="co"># Drop unused cases</span></span>
<span id="cb115-4"><a href="the-many-variables-the-spurious-waffles.html#cb115-4" aria-hidden="true"></a>d &lt;-<span class="st"> </span>d<span class="op">%&gt;%</span><span class="kw">select</span>(kcal.per.g, mass, neocortex.perc)</span>
<span id="cb115-5"><a href="the-many-variables-the-spurious-waffles.html#cb115-5" aria-hidden="true"></a>dcc &lt;-<span class="st"> </span>d[<span class="kw">complete.cases</span>(d),]</span>
<span id="cb115-6"><a href="the-many-variables-the-spurious-waffles.html#cb115-6" aria-hidden="true"></a></span>
<span id="cb115-7"><a href="the-many-variables-the-spurious-waffles.html#cb115-7" aria-hidden="true"></a><span class="co">#standardise variables of interest</span></span>
<span id="cb115-8"><a href="the-many-variables-the-spurious-waffles.html#cb115-8" aria-hidden="true"></a>dcc<span class="op">$</span>K &lt;-<span class="st"> </span>( dcc<span class="op">$</span>kcal.per.g <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(dcc<span class="op">$</span>kcal.per.g )) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(dcc<span class="op">$</span>kcal.per.g)</span>
<span id="cb115-9"><a href="the-many-variables-the-spurious-waffles.html#cb115-9" aria-hidden="true"></a>dcc<span class="op">$</span>M &lt;-<span class="st"> </span>( dcc<span class="op">$</span>mass <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(dcc<span class="op">$</span>mass)  ) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(dcc<span class="op">$</span>mass)</span>
<span id="cb115-10"><a href="the-many-variables-the-spurious-waffles.html#cb115-10" aria-hidden="true"></a>dcc<span class="op">$</span>N &lt;-<span class="st"> </span>( dcc<span class="op">$</span>neocortex.perc <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(dcc<span class="op">$</span>neocortex.perc)) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(dcc<span class="op">$</span>neocortex.perc)</span></code></pre></div>
<p>The building block of the mode is as follows</p>
<p><span class="math display">\[K_i \sim \mathrm{Normal}(\mu_i , \sigma)\\
\mu_i = \alpha + \beta_N N_i\]</span></p>
<p>But what about the priors? Let’s pick Normal(0,1) for the beginning.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="the-many-variables-the-spurious-waffles.html#cb116-1" aria-hidden="true"></a><span class="co"># prior predictive simulations</span></span>
<span id="cb116-2"><a href="the-many-variables-the-spurious-waffles.html#cb116-2" aria-hidden="true"></a>N &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb116-3"><a href="the-many-variables-the-spurious-waffles.html#cb116-3" aria-hidden="true"></a>pr_alpha  &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb116-4"><a href="the-many-variables-the-spurious-waffles.html#cb116-4" aria-hidden="true"></a>pr_beta_N &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb116-5"><a href="the-many-variables-the-spurious-waffles.html#cb116-5" aria-hidden="true"></a>pr_sigma &lt;-<span class="st"> </span><span class="kw">rexp</span>(N, <span class="dv">1</span>)</span>
<span id="cb116-6"><a href="the-many-variables-the-spurious-waffles.html#cb116-6" aria-hidden="true"></a>xseq &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb116-7"><a href="the-many-variables-the-spurious-waffles.html#cb116-7" aria-hidden="true"></a>pr_mu   &lt;-<span class="st"> </span>pr_alpha <span class="op">+</span><span class="st"> </span>pr_beta_N <span class="op">*</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb116-8"><a href="the-many-variables-the-spurious-waffles.html#cb116-8" aria-hidden="true"></a>pr_pred &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N,</span>
<span id="cb116-9"><a href="the-many-variables-the-spurious-waffles.html#cb116-9" aria-hidden="true"></a>               <span class="dt">mean =</span> pr_alpha <span class="op">+</span><span class="st"> </span>pr_beta_N <span class="op">*</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb116-10"><a href="the-many-variables-the-spurious-waffles.html#cb116-10" aria-hidden="true"></a>               <span class="dt">sd =</span> pr_sigma)</span>
<span id="cb116-11"><a href="the-many-variables-the-spurious-waffles.html#cb116-11" aria-hidden="true"></a></span>
<span id="cb116-12"><a href="the-many-variables-the-spurious-waffles.html#cb116-12" aria-hidden="true"></a><span class="kw">plot</span>(<span class="ot">NULL</span>, <span class="dt">xlim=</span>xseq, <span class="dt">ylim=</span>xseq)</span>
<span id="cb116-13"><a href="the-many-variables-the-spurious-waffles.html#cb116-13" aria-hidden="true"></a>x=<span class="dv">1</span></span>
<span id="cb116-14"><a href="the-many-variables-the-spurious-waffles.html#cb116-14" aria-hidden="true"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>N ) <span class="kw">curve</span>(pr_alpha[i] <span class="op">+</span><span class="st"> </span>pr_beta_N[i]<span class="op">*</span>x , </span>
<span id="cb116-15"><a href="the-many-variables-the-spurious-waffles.html#cb116-15" aria-hidden="true"></a>                      <span class="dt">from =</span> <span class="dv">-2</span>, <span class="dt">to=</span><span class="dv">2</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>,</span>
<span id="cb116-16"><a href="the-many-variables-the-spurious-waffles.html#cb116-16" aria-hidden="true"></a>                      <span class="dt">col =</span> <span class="kw">col.alpha</span>(<span class="st">&quot;black&quot;</span>, <span class="fl">0.2</span>)) <span class="co"># terrible prior</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-92-1.png" width="100%" /></p>
<p>Seems horribe. Let’s use the ones from the previous chapter.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="the-many-variables-the-spurious-waffles.html#cb117-1" aria-hidden="true"></a>pr_alpha &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dv">0</span>, <span class="fl">0.2</span>)</span>
<span id="cb117-2"><a href="the-many-variables-the-spurious-waffles.html#cb117-2" aria-hidden="true"></a>pr_beta_N &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb117-3"><a href="the-many-variables-the-spurious-waffles.html#cb117-3" aria-hidden="true"></a>xseq &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb117-4"><a href="the-many-variables-the-spurious-waffles.html#cb117-4" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb117-5"><a href="the-many-variables-the-spurious-waffles.html#cb117-5" aria-hidden="true"></a><span class="kw">plot</span>(<span class="ot">NULL</span>, <span class="dt">xlim=</span>xseq, <span class="dt">ylim=</span>xseq)</span>
<span id="cb117-6"><a href="the-many-variables-the-spurious-waffles.html#cb117-6" aria-hidden="true"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>N) <span class="kw">curve</span>(pr_alpha[i] <span class="op">+</span><span class="st"> </span>pr_beta_N[i] <span class="op">*</span><span class="st"> </span>x,</span>
<span id="cb117-7"><a href="the-many-variables-the-spurious-waffles.html#cb117-7" aria-hidden="true"></a>                     <span class="dt">from =</span> <span class="dv">-2</span>, <span class="dt">to =</span><span class="dv">2</span>, <span class="dt">add=</span>T,</span>
<span id="cb117-8"><a href="the-many-variables-the-spurious-waffles.html#cb117-8" aria-hidden="true"></a>                     <span class="dt">col =</span> <span class="kw">col.alpha</span>(<span class="st">&quot;black&quot;</span>, <span class="fl">0.2</span>)) <span class="co"># reasonable prior</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-93-1.png" width="100%" /></p>
<p>Prepare the stan model</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="the-many-variables-the-spurious-waffles.html#cb118-1" aria-hidden="true"></a>dat_neo &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">N =</span> <span class="kw">NROW</span>(dcc),</span>
<span id="cb118-2"><a href="the-many-variables-the-spurious-waffles.html#cb118-2" aria-hidden="true"></a>                   <span class="dt">K =</span> dcc<span class="op">$</span>K,</span>
<span id="cb118-3"><a href="the-many-variables-the-spurious-waffles.html#cb118-3" aria-hidden="true"></a>                   <span class="dt">Neo =</span> dcc<span class="op">$</span>N)</span></code></pre></div>
<p>And the stan program</p>
<pre class="stan"><code>data{
  int&lt;lower=1&gt; N;
  vector[N] Neo;
  vector[N] K;
}
parameters{
  real alpha;
  real beta_Neo;
  real&lt;lower=0&gt; sigma;
}
transformed parameters{
  vector[N] mu = alpha + beta_Neo * Neo;
}
model{
  K ~ normal(mu,sigma);
  alpha ~ normal(0, 0.2);
  beta_Neo ~ normal(0, 0.2);
  sigma ~ exponential(1);
}</code></pre>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="the-many-variables-the-spurious-waffles.html#cb120-1" aria-hidden="true"></a>fit_neo &lt;-<span class="st"> </span><span class="kw">sampling</span>(milk_neo.stan,</span>
<span id="cb120-2"><a href="the-many-variables-the-spurious-waffles.html#cb120-2" aria-hidden="true"></a>                    dat_neo,</span>
<span id="cb120-3"><a href="the-many-variables-the-spurious-waffles.html#cb120-3" aria-hidden="true"></a>                    <span class="dt">chains=</span><span class="dv">2</span>,</span>
<span id="cb120-4"><a href="the-many-variables-the-spurious-waffles.html#cb120-4" aria-hidden="true"></a>                    <span class="dt">cores=</span><span class="dv">4</span>,</span>
<span id="cb120-5"><a href="the-many-variables-the-spurious-waffles.html#cb120-5" aria-hidden="true"></a>                    <span class="dt">iter=</span><span class="dv">1000</span>)</span></code></pre></div>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="the-many-variables-the-spurious-waffles.html#cb121-1" aria-hidden="true"></a><span class="kw">print</span>(fit_neo, <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta_Neo&quot;</span>, <span class="st">&quot;sigma&quot;</span>))</span></code></pre></div>
<pre><code>## Inference for Stan model: stan-19823290a60a.
## 2 chains, each with iter=1000; warmup=500; thin=1; 
## post-warmup draws per chain=500, total post-warmup draws=1000.
## 
##          mean se_mean   sd  2.5%   25%  50%  75% 97.5% n_eff Rhat
## alpha    0.00    0.01 0.14 -0.28 -0.09 0.00 0.10  0.27   775    1
## beta_Neo 0.06    0.00 0.15 -0.25 -0.04 0.05 0.15  0.37  1040    1
## sigma    1.02    0.01 0.18  0.75  0.89 0.99 1.12  1.46   552    1
## 
## Samples were drawn using NUTS(diag_e) at Sat Jul 17 13:48:41 2021.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="the-many-variables-the-spurious-waffles.html#cb123-1" aria-hidden="true"></a>p_dat_neo &lt;-<span class="st"> </span>fit_neo<span class="op">%&gt;%</span></span>
<span id="cb123-2"><a href="the-many-variables-the-spurious-waffles.html#cb123-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">gather_draws</span>(mu[i]) <span class="op">%&gt;%</span></span>
<span id="cb123-3"><a href="the-many-variables-the-spurious-waffles.html#cb123-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">mean_qi</span>() <span class="op">%&gt;%</span></span>
<span id="cb123-4"><a href="the-many-variables-the-spurious-waffles.html#cb123-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">mu =</span> .value)</span>
<span id="cb123-5"><a href="the-many-variables-the-spurious-waffles.html#cb123-5" aria-hidden="true"></a></span>
<span id="cb123-6"><a href="the-many-variables-the-spurious-waffles.html#cb123-6" aria-hidden="true"></a>p_dat_neo<span class="op">$</span>neo &lt;-<span class="st"> </span>dcc<span class="op">$</span>N</span>
<span id="cb123-7"><a href="the-many-variables-the-spurious-waffles.html#cb123-7" aria-hidden="true"></a>p_dat_neo<span class="op">$</span>K &lt;-<span class="st"> </span>dcc<span class="op">$</span>K</span>
<span id="cb123-8"><a href="the-many-variables-the-spurious-waffles.html#cb123-8" aria-hidden="true"></a></span>
<span id="cb123-9"><a href="the-many-variables-the-spurious-waffles.html#cb123-9" aria-hidden="true"></a>p_neo &lt;-<span class="kw">ggplot</span>(p_dat_neo, <span class="kw">aes</span>(<span class="dt">x=</span>neo, <span class="dt">y=</span>K)) <span class="op">+</span></span>
<span id="cb123-10"><a href="the-many-variables-the-spurious-waffles.html#cb123-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb123-11"><a href="the-many-variables-the-spurious-waffles.html#cb123-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x=</span>neo, <span class="dt">y=</span>mu, <span class="dt">ymin=</span>.lower, <span class="dt">ymax=</span>.upper), <span class="dt">alpha=</span><span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb123-12"><a href="the-many-variables-the-spurious-waffles.html#cb123-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>neo, <span class="dt">y=</span>mu), <span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb123-13"><a href="the-many-variables-the-spurious-waffles.html#cb123-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;neo cortex percent (std)&quot;</span>) <span class="op">+</span></span>
<span id="cb123-14"><a href="the-many-variables-the-spurious-waffles.html#cb123-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;kilocal per grams (std)&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="the-many-variables-the-spurious-waffles.html#cb124-1" aria-hidden="true"></a><span class="co"># log standardise the mass</span></span>
<span id="cb124-2"><a href="the-many-variables-the-spurious-waffles.html#cb124-2" aria-hidden="true"></a>dcc<span class="op">$</span>logmass &lt;-<span class="st"> </span>( <span class="kw">log</span>(dcc<span class="op">$</span>mass) <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>( <span class="kw">log</span>(dcc<span class="op">$</span>mass) ) ) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(<span class="kw">log</span>(dcc<span class="op">$</span>mass))</span>
<span id="cb124-3"><a href="the-many-variables-the-spurious-waffles.html#cb124-3" aria-hidden="true"></a></span>
<span id="cb124-4"><a href="the-many-variables-the-spurious-waffles.html#cb124-4" aria-hidden="true"></a><span class="co"># stan data</span></span>
<span id="cb124-5"><a href="the-many-variables-the-spurious-waffles.html#cb124-5" aria-hidden="true"></a>dat_mass &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">N =</span> <span class="kw">NROW</span>(dcc),</span>
<span id="cb124-6"><a href="the-many-variables-the-spurious-waffles.html#cb124-6" aria-hidden="true"></a>                 <span class="dt">Mass =</span> dcc<span class="op">$</span>logmass,</span>
<span id="cb124-7"><a href="the-many-variables-the-spurious-waffles.html#cb124-7" aria-hidden="true"></a>                 <span class="dt">K =</span> dcc<span class="op">$</span>K)</span></code></pre></div>
<pre class="stan"><code>data{
  int&lt;lower=1&gt; N;
  vector[N] Mass;
  vector[N] K;
}
parameters{
  real alpha;
  real beta_Mass;
  real&lt;lower=0&gt; sigma;
}
transformed parameters{
  vector[N] mu = alpha + beta_Mass * Mass;
}
model{
  K ~ normal(mu, sigma);
  alpha ~ normal(0, 0.2);
  beta_Mass ~ normal(0, 0.5);
  sigma ~ exponential(1);
}
</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="the-many-variables-the-spurious-waffles.html#cb126-1" aria-hidden="true"></a>fit_mass &lt;-<span class="st"> </span><span class="kw">sampling</span>(milk_mass.stan,</span>
<span id="cb126-2"><a href="the-many-variables-the-spurious-waffles.html#cb126-2" aria-hidden="true"></a>                     dat_mass,</span>
<span id="cb126-3"><a href="the-many-variables-the-spurious-waffles.html#cb126-3" aria-hidden="true"></a>                     <span class="dt">chains=</span><span class="dv">2</span>,</span>
<span id="cb126-4"><a href="the-many-variables-the-spurious-waffles.html#cb126-4" aria-hidden="true"></a>                     <span class="dt">cores=</span><span class="dv">4</span>,</span>
<span id="cb126-5"><a href="the-many-variables-the-spurious-waffles.html#cb126-5" aria-hidden="true"></a>                     <span class="dt">iter=</span><span class="dv">1000</span>)</span></code></pre></div>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="the-many-variables-the-spurious-waffles.html#cb127-1" aria-hidden="true"></a><span class="kw">print</span>(fit_mass, <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta_Mass&quot;</span>, <span class="st">&quot;sigma&quot;</span>))</span></code></pre></div>
<pre><code>## Inference for Stan model: stan-1982726e0f64.
## 2 chains, each with iter=1000; warmup=500; thin=1; 
## post-warmup draws per chain=500, total post-warmup draws=1000.
## 
##            mean se_mean   sd  2.5%   25%   50%   75% 97.5% n_eff Rhat
## alpha      0.00    0.00 0.15 -0.30 -0.11 -0.01  0.10  0.30   942 1.00
## beta_Mass -0.29    0.01 0.23 -0.74 -0.44 -0.29 -0.14  0.18   781 1.00
## sigma      0.99    0.01 0.18  0.72  0.86  0.96  1.10  1.40   529 1.01
## 
## Samples were drawn using NUTS(diag_e) at Sat Jul 17 13:48:47 2021.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="the-many-variables-the-spurious-waffles.html#cb129-1" aria-hidden="true"></a>p_dat_mass &lt;-<span class="st"> </span>fit_mass<span class="op">%&gt;%</span></span>
<span id="cb129-2"><a href="the-many-variables-the-spurious-waffles.html#cb129-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">gather_draws</span>(mu[i])<span class="op">%&gt;%</span></span>
<span id="cb129-3"><a href="the-many-variables-the-spurious-waffles.html#cb129-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">mean_qi</span>()<span class="op">%&gt;%</span></span>
<span id="cb129-4"><a href="the-many-variables-the-spurious-waffles.html#cb129-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">post_mu =</span> .value)</span>
<span id="cb129-5"><a href="the-many-variables-the-spurious-waffles.html#cb129-5" aria-hidden="true"></a></span>
<span id="cb129-6"><a href="the-many-variables-the-spurious-waffles.html#cb129-6" aria-hidden="true"></a>p_dat_mass<span class="op">$</span>K &lt;-<span class="st"> </span>dcc<span class="op">$</span>K</span>
<span id="cb129-7"><a href="the-many-variables-the-spurious-waffles.html#cb129-7" aria-hidden="true"></a>p_dat_mass<span class="op">$</span>logmass &lt;-<span class="st"> </span>dcc<span class="op">$</span>logmass</span>
<span id="cb129-8"><a href="the-many-variables-the-spurious-waffles.html#cb129-8" aria-hidden="true"></a></span>
<span id="cb129-9"><a href="the-many-variables-the-spurious-waffles.html#cb129-9" aria-hidden="true"></a>p_mass &lt;-<span class="st"> </span><span class="kw">ggplot</span>(p_dat_mass, <span class="kw">aes</span>(<span class="dt">x=</span>logmass, <span class="dt">y=</span>K)) <span class="op">+</span></span>
<span id="cb129-10"><a href="the-many-variables-the-spurious-waffles.html#cb129-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb129-11"><a href="the-many-variables-the-spurious-waffles.html#cb129-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x=</span>logmass, <span class="dt">y=</span>post_mu, <span class="dt">ymin=</span>.lower, <span class="dt">ymax=</span>.upper), <span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb129-12"><a href="the-many-variables-the-spurious-waffles.html#cb129-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>logmass, <span class="dt">y=</span>post_mu), <span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb129-13"><a href="the-many-variables-the-spurious-waffles.html#cb129-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;log body mass (std)&quot;</span>) <span class="op">+</span></span>
<span id="cb129-14"><a href="the-many-variables-the-spurious-waffles.html#cb129-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;kilocal per grams (std)&quot;</span>)</span>
<span id="cb129-15"><a href="the-many-variables-the-spurious-waffles.html#cb129-15" aria-hidden="true"></a></span>
<span id="cb129-16"><a href="the-many-variables-the-spurious-waffles.html#cb129-16" aria-hidden="true"></a>p_neo <span class="op">+</span><span class="st"> </span>p_mass</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-103-1.png" width="100%" />
### Multivariate Model</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="the-many-variables-the-spurious-waffles.html#cb130-1" aria-hidden="true"></a>dat_multivariate &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">N =</span> <span class="kw">NROW</span>(dcc),</span>
<span id="cb130-2"><a href="the-many-variables-the-spurious-waffles.html#cb130-2" aria-hidden="true"></a>                         <span class="dt">K =</span> dcc<span class="op">$</span>K,</span>
<span id="cb130-3"><a href="the-many-variables-the-spurious-waffles.html#cb130-3" aria-hidden="true"></a>                         <span class="dt">Mass =</span> dcc<span class="op">$</span>logmass,</span>
<span id="cb130-4"><a href="the-many-variables-the-spurious-waffles.html#cb130-4" aria-hidden="true"></a>                         <span class="dt">Neo =</span> dcc<span class="op">$</span>N)</span></code></pre></div>
<pre class="stan"><code>data{
  int&lt;lower=1&gt; N;
  vector[N] K;
  vector[N] Mass;
  vector[N] Neo;
}
parameters{
  real alpha;
  real beta_Mass;
  real beta_Neo;
  real&lt;lower=0&gt; sigma;
}
transformed parameters{
  vector[N] mu = alpha + beta_Mass * Mass + beta_Neo * Neo;
}
model{
  K ~ normal(mu, sigma);
  alpha ~ normal(0, 0.2);
  beta_Mass ~ normal(0, 0.5);
  beta_Neo ~ normal(0, 0.5);
  sigma ~ exponential(1);
}</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="the-many-variables-the-spurious-waffles.html#cb132-1" aria-hidden="true"></a>fit_multivariate &lt;-<span class="st"> </span><span class="kw">sampling</span>(milk_multivariate.stan,</span>
<span id="cb132-2"><a href="the-many-variables-the-spurious-waffles.html#cb132-2" aria-hidden="true"></a>                             dat_multivariate,</span>
<span id="cb132-3"><a href="the-many-variables-the-spurious-waffles.html#cb132-3" aria-hidden="true"></a>                             <span class="dt">cores=</span><span class="dv">4</span>,</span>
<span id="cb132-4"><a href="the-many-variables-the-spurious-waffles.html#cb132-4" aria-hidden="true"></a>                             <span class="dt">chains=</span><span class="dv">2</span>,</span>
<span id="cb132-5"><a href="the-many-variables-the-spurious-waffles.html#cb132-5" aria-hidden="true"></a>                             <span class="dt">iter=</span><span class="dv">1000</span>)</span></code></pre></div>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="the-many-variables-the-spurious-waffles.html#cb133-1" aria-hidden="true"></a><span class="kw">print</span>(fit_multivariate, <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta_Neo&quot;</span>, <span class="st">&quot;beta_Mass&quot;</span>, <span class="st">&quot;sigma&quot;</span>))</span></code></pre></div>
<pre><code>## Inference for Stan model: stan-19822fafcbfb.
## 2 chains, each with iter=1000; warmup=500; thin=1; 
## post-warmup draws per chain=500, total post-warmup draws=1000.
## 
##            mean se_mean   sd  2.5%   25%   50%   75% 97.5% n_eff Rhat
## alpha     -0.01    0.00 0.14 -0.28 -0.10 -0.01  0.08  0.25   845    1
## beta_Neo   0.57    0.01 0.25  0.04  0.42  0.58  0.73  1.04   437    1
## beta_Mass -0.68    0.01 0.26 -1.20 -0.84 -0.69 -0.51 -0.13   490    1
## sigma      0.80    0.01 0.17  0.55  0.69  0.78  0.89  1.22   567    1
## 
## Samples were drawn using NUTS(diag_e) at Sat Jul 17 13:48:53 2021.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="the-many-variables-the-spurious-waffles.html#cb135-1" aria-hidden="true"></a><span class="co"># posterior</span></span>
<span id="cb135-2"><a href="the-many-variables-the-spurious-waffles.html#cb135-2" aria-hidden="true"></a>post_multivariate &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(fit_multivariate)</span>
<span id="cb135-3"><a href="the-many-variables-the-spurious-waffles.html#cb135-3" aria-hidden="true"></a><span class="co"># CF_LOGMASS</span></span>
<span id="cb135-4"><a href="the-many-variables-the-spurious-waffles.html#cb135-4" aria-hidden="true"></a>logmass_new &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from=</span><span class="kw">min</span>(dcc<span class="op">$</span>M)<span class="op">-</span><span class="fl">0.15</span> , <span class="dt">to=</span><span class="kw">max</span>(dcc<span class="op">$</span>M)<span class="op">+</span><span class="fl">0.15</span>, <span class="dt">length.out =</span> <span class="dv">30</span>)</span>
<span id="cb135-5"><a href="the-many-variables-the-spurious-waffles.html#cb135-5" aria-hidden="true"></a></span>
<span id="cb135-6"><a href="the-many-variables-the-spurious-waffles.html#cb135-6" aria-hidden="true"></a>sim_int_mass &lt;-<span class="st"> </span><span class="cf">function</span>(x,y) <span class="kw">rnorm</span>(<span class="dv">10000</span>,</span>
<span id="cb135-7"><a href="the-many-variables-the-spurious-waffles.html#cb135-7" aria-hidden="true"></a>                                 <span class="dt">mean =</span> <span class="kw">with</span>(post_multivariate, alpha <span class="op">+</span><span class="st"> </span>beta_Neo <span class="op">*</span><span class="st"> </span>y <span class="op">+</span><span class="st"> </span>beta_Mass <span class="op">*</span><span class="st"> </span>x),</span>
<span id="cb135-8"><a href="the-many-variables-the-spurious-waffles.html#cb135-8" aria-hidden="true"></a>                                 <span class="dt">sd =</span> post_multivariate<span class="op">$</span>sigma)</span>
<span id="cb135-9"><a href="the-many-variables-the-spurious-waffles.html#cb135-9" aria-hidden="true"></a></span>
<span id="cb135-10"><a href="the-many-variables-the-spurious-waffles.html#cb135-10" aria-hidden="true"></a>p_cf_M &lt;-<span class="kw">sapply</span>(logmass_new, sim_int_mass, <span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb135-11"><a href="the-many-variables-the-spurious-waffles.html#cb135-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb135-12"><a href="the-many-variables-the-spurious-waffles.html#cb135-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename_all</span>(<span class="cf">function</span>(x) logmass_new) <span class="op">%&gt;%</span></span>
<span id="cb135-13"><a href="the-many-variables-the-spurious-waffles.html#cb135-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iteration =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span></span>
<span id="cb135-14"><a href="the-many-variables-the-spurious-waffles.html#cb135-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">gather</span>(logmass_new, yhat, <span class="op">-</span>iteration) <span class="op">%&gt;%</span></span>
<span id="cb135-15"><a href="the-many-variables-the-spurious-waffles.html#cb135-15" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(logmass_new) <span class="op">%&gt;%</span></span>
<span id="cb135-16"><a href="the-many-variables-the-spurious-waffles.html#cb135-16" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pi_l =</span> rethinking<span class="op">::</span><span class="kw">PI</span>(yhat, <span class="dt">prob=</span><span class="fl">0.8</span>)[<span class="dv">1</span>],</span>
<span id="cb135-17"><a href="the-many-variables-the-spurious-waffles.html#cb135-17" aria-hidden="true"></a>         <span class="dt">pi_h =</span> rethinking<span class="op">::</span><span class="kw">PI</span>(yhat, <span class="dt">prob=</span><span class="fl">0.8</span>)[<span class="dv">2</span>],</span>
<span id="cb135-18"><a href="the-many-variables-the-spurious-waffles.html#cb135-18" aria-hidden="true"></a>         <span class="dt">yhat_mu =</span> <span class="kw">mean</span>(yhat)) <span class="op">%&gt;%</span></span>
<span id="cb135-19"><a href="the-many-variables-the-spurious-waffles.html#cb135-19" aria-hidden="true"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb135-20"><a href="the-many-variables-the-spurious-waffles.html#cb135-20" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">logmass_new =</span> <span class="kw">as.numeric</span>(logmass_new),</span>
<span id="cb135-21"><a href="the-many-variables-the-spurious-waffles.html#cb135-21" aria-hidden="true"></a>         <span class="dt">yhat =</span> <span class="kw">as.numeric</span>(yhat),</span>
<span id="cb135-22"><a href="the-many-variables-the-spurious-waffles.html#cb135-22" aria-hidden="true"></a>         <span class="dt">yhat_mu =</span> <span class="kw">as.numeric</span>(yhat_mu))<span class="op">%&gt;%</span></span>
<span id="cb135-23"><a href="the-many-variables-the-spurious-waffles.html#cb135-23" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb135-24"><a href="the-many-variables-the-spurious-waffles.html#cb135-24" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">round</span>(logmass_new, <span class="dv">2</span>), <span class="dt">y=</span>yhat_mu, <span class="dt">ymin=</span>pi_l, <span class="dt">ymax=</span>pi_h), <span class="dt">alpha=</span><span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb135-25"><a href="the-many-variables-the-spurious-waffles.html#cb135-25" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>logmass_new, <span class="dt">y=</span>yhat_mu), <span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb135-26"><a href="the-many-variables-the-spurious-waffles.html#cb135-26" aria-hidden="true"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Manipulated log body mass&quot;</span>) <span class="op">+</span></span>
<span id="cb135-27"><a href="the-many-variables-the-spurious-waffles.html#cb135-27" aria-hidden="true"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Counterfactual kilocal per grams&quot;</span>)<span class="op">+</span></span>
<span id="cb135-28"><a href="the-many-variables-the-spurious-waffles.html#cb135-28" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Counterfactual holding N=0&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="the-many-variables-the-spurious-waffles.html#cb136-1" aria-hidden="true"></a><span class="co">#CF NEO</span></span>
<span id="cb136-2"><a href="the-many-variables-the-spurious-waffles.html#cb136-2" aria-hidden="true"></a>neo_new =<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from=</span><span class="kw">min</span>(dcc<span class="op">$</span>N)<span class="op">-</span><span class="fl">0.15</span> , <span class="dt">to=</span><span class="kw">max</span>(dcc<span class="op">$</span>N)<span class="op">+</span><span class="fl">0.15</span>, <span class="dt">length.out =</span> <span class="dv">30</span>)</span>
<span id="cb136-3"><a href="the-many-variables-the-spurious-waffles.html#cb136-3" aria-hidden="true"></a></span>
<span id="cb136-4"><a href="the-many-variables-the-spurious-waffles.html#cb136-4" aria-hidden="true"></a>sim_int_neo &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) <span class="kw">rnorm</span>(<span class="dv">10000</span>,</span>
<span id="cb136-5"><a href="the-many-variables-the-spurious-waffles.html#cb136-5" aria-hidden="true"></a>                                 <span class="dt">mean =</span> <span class="kw">with</span>(post_multivariate,</span>
<span id="cb136-6"><a href="the-many-variables-the-spurious-waffles.html#cb136-6" aria-hidden="true"></a>                                             alpha <span class="op">+</span><span class="st"> </span>beta_Neo <span class="op">*</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>beta_Mass <span class="op">*</span><span class="st"> </span>y),</span>
<span id="cb136-7"><a href="the-many-variables-the-spurious-waffles.html#cb136-7" aria-hidden="true"></a>                                 <span class="dt">sd =</span>post_multivariate<span class="op">$</span>sigma)</span>
<span id="cb136-8"><a href="the-many-variables-the-spurious-waffles.html#cb136-8" aria-hidden="true"></a>p_cf_N &lt;-<span class="st"> </span><span class="kw">sapply</span>(neo_new, sim_int_neo, <span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb136-9"><a href="the-many-variables-the-spurious-waffles.html#cb136-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb136-10"><a href="the-many-variables-the-spurious-waffles.html#cb136-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename_all</span>(<span class="cf">function</span>(x) neo_new) <span class="op">%&gt;%</span></span>
<span id="cb136-11"><a href="the-many-variables-the-spurious-waffles.html#cb136-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iteration =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span></span>
<span id="cb136-12"><a href="the-many-variables-the-spurious-waffles.html#cb136-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">gather</span>(neo_new, yhat, <span class="op">-</span>iteration) <span class="op">%&gt;%</span></span>
<span id="cb136-13"><a href="the-many-variables-the-spurious-waffles.html#cb136-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(neo_new) <span class="op">%&gt;%</span></span>
<span id="cb136-14"><a href="the-many-variables-the-spurious-waffles.html#cb136-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pi_l =</span> rethinking<span class="op">::</span><span class="kw">PI</span>(yhat, <span class="dt">prob=</span><span class="fl">0.8</span>)[<span class="dv">1</span>],</span>
<span id="cb136-15"><a href="the-many-variables-the-spurious-waffles.html#cb136-15" aria-hidden="true"></a>         <span class="dt">pi_h =</span> rethinking<span class="op">::</span><span class="kw">PI</span>(yhat, <span class="dt">prob=</span><span class="fl">0.8</span>)[<span class="dv">2</span>],</span>
<span id="cb136-16"><a href="the-many-variables-the-spurious-waffles.html#cb136-16" aria-hidden="true"></a>         <span class="dt">yhat_mu =</span> <span class="kw">mean</span>(yhat)) <span class="op">%&gt;%</span></span>
<span id="cb136-17"><a href="the-many-variables-the-spurious-waffles.html#cb136-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">neo_new =</span> <span class="kw">as.numeric</span>(neo_new),</span>
<span id="cb136-18"><a href="the-many-variables-the-spurious-waffles.html#cb136-18" aria-hidden="true"></a>         <span class="dt">yhat =</span> <span class="kw">as.numeric</span>(yhat),</span>
<span id="cb136-19"><a href="the-many-variables-the-spurious-waffles.html#cb136-19" aria-hidden="true"></a>         <span class="dt">yhat_mu =</span> <span class="kw">as.numeric</span>(yhat_mu))<span class="op">%&gt;%</span></span>
<span id="cb136-20"><a href="the-many-variables-the-spurious-waffles.html#cb136-20" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb136-21"><a href="the-many-variables-the-spurious-waffles.html#cb136-21" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">round</span>(neo_new, <span class="dv">2</span>), <span class="dt">y=</span>yhat_mu, <span class="dt">ymin=</span>pi_l, <span class="dt">ymax=</span>pi_h), <span class="dt">alpha=</span><span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb136-22"><a href="the-many-variables-the-spurious-waffles.html#cb136-22" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>neo_new, <span class="dt">y=</span>yhat_mu), <span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb136-23"><a href="the-many-variables-the-spurious-waffles.html#cb136-23" aria-hidden="true"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Manipulated Neocortex %&quot;</span>) <span class="op">+</span></span>
<span id="cb136-24"><a href="the-many-variables-the-spurious-waffles.html#cb136-24" aria-hidden="true"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Counterfactual kilocal per grams&quot;</span>)<span class="op">+</span></span>
<span id="cb136-25"><a href="the-many-variables-the-spurious-waffles.html#cb136-25" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Counterfactual holding M=0&quot;</span>)</span>
<span id="cb136-26"><a href="the-many-variables-the-spurious-waffles.html#cb136-26" aria-hidden="true"></a></span>
<span id="cb136-27"><a href="the-many-variables-the-spurious-waffles.html#cb136-27" aria-hidden="true"></a>p_cf_M <span class="op">+</span>p_cf_N</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-109-1.png" width="100%" /></p>
</div>
<div id="categorical-variables" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Categorical Variables</h2>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="the-many-variables-the-spurious-waffles.html#cb137-1" aria-hidden="true"></a><span class="co">#data</span></span>
<span id="cb137-2"><a href="the-many-variables-the-spurious-waffles.html#cb137-2" aria-hidden="true"></a><span class="kw">data</span>(<span class="st">&quot;Howell1&quot;</span>)</span>
<span id="cb137-3"><a href="the-many-variables-the-spurious-waffles.html#cb137-3" aria-hidden="true"></a>d &lt;-<span class="st"> </span>Howell1</span>
<span id="cb137-4"><a href="the-many-variables-the-spurious-waffles.html#cb137-4" aria-hidden="true"></a></span>
<span id="cb137-5"><a href="the-many-variables-the-spurious-waffles.html#cb137-5" aria-hidden="true"></a><span class="kw">precis</span>(d)</span></code></pre></div>
<pre><code>##               mean         sd      5.5%     94.5%     histogram
## height 138.2635963 27.6024476 81.108550 165.73500 ▁▁▁▁▁▁▁▂▁▇▇▅▁
## weight  35.6106176 14.7191782  9.360721  54.50289 ▁▂▃▂▂▂▂▅▇▇▃▂▁
## age     29.3443934 20.7468882  1.000000  66.13500     ▇▅▅▃▅▂▂▁▁
## male     0.4724265  0.4996986  0.000000   1.00000    ▇▁▁▁▁▁▁▁▁▇</code></pre>
<div id="indicator-variables" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Indicator Variables</h3>
<p>Problem with indicator variables</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="the-many-variables-the-spurious-waffles.html#cb139-1" aria-hidden="true"></a>mu_female &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="fl">1e4</span>,<span class="dv">178</span>,<span class="dv">20</span>)</span>
<span id="cb139-2"><a href="the-many-variables-the-spurious-waffles.html#cb139-2" aria-hidden="true"></a>mu_male &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="fl">1e4</span>,<span class="dv">178</span>,<span class="dv">20</span>) <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="fl">1e4</span>,<span class="dv">0</span>,<span class="dv">10</span>)</span>
<span id="cb139-3"><a href="the-many-variables-the-spurious-waffles.html#cb139-3" aria-hidden="true"></a><span class="kw">precis</span>( <span class="kw">data.frame</span>( mu_female , mu_male ) ) <span class="co"># mu male has wider tails</span></span></code></pre></div>
<pre><code>##               mean       sd     5.5%    94.5%  histogram
## mu_female 178.0280 20.02640 145.6407 209.8339 ▁▁▁▃▇▇▂▁▁▁
## mu_male   177.9283 22.28724 142.4056 213.9112 ▁▁▁▃▇▇▂▁▁▁</code></pre>
</div>
<div id="index-variables" class="section level3" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Index Variables</h3>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="the-many-variables-the-spurious-waffles.html#cb141-1" aria-hidden="true"></a><span class="co"># Introducing INDEX VARIABLE</span></span>
<span id="cb141-2"><a href="the-many-variables-the-spurious-waffles.html#cb141-2" aria-hidden="true"></a>d<span class="op">$</span>sex &lt;-<span class="st"> </span><span class="kw">ifelse</span>(d<span class="op">$</span>male, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb141-3"><a href="the-many-variables-the-spurious-waffles.html#cb141-3" aria-hidden="true"></a><span class="kw">str</span>(d<span class="op">$</span>sex)</span></code></pre></div>
<pre><code>##  num [1:544] 1 2 2 1 2 1 2 1 2 1 ...</code></pre>
<p>stan model with index variable</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="the-many-variables-the-spurious-waffles.html#cb143-1" aria-hidden="true"></a>dat_index &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">N =</span> <span class="kw">NROW</span>(d),</span>
<span id="cb143-2"><a href="the-many-variables-the-spurious-waffles.html#cb143-2" aria-hidden="true"></a>                  <span class="dt">S =</span> d<span class="op">$</span>sex,</span>
<span id="cb143-3"><a href="the-many-variables-the-spurious-waffles.html#cb143-3" aria-hidden="true"></a>                  <span class="dt">H =</span> d<span class="op">$</span>height,</span>
<span id="cb143-4"><a href="the-many-variables-the-spurious-waffles.html#cb143-4" aria-hidden="true"></a>                  <span class="dt">J =</span> <span class="kw">length</span>(<span class="kw">unique</span>(d<span class="op">$</span>sex)))</span></code></pre></div>
<p>If you are curious about J, please bear with me for a while. I’ll explain all.</p>
<pre class="stan"><code>data{
  int&lt;lower=1&gt; N;
  int&lt;lower=1&gt; J;
  int&lt;lower=1, upper=J&gt; S[N];
  vector[N] H;
}
parameters {
  vector[J] alpha;
  real&lt;lower=0, upper=50&gt; sigma;
}
transformed parameters{
  vector[N] mu = alpha[S];
}
model{
  H ~ normal(mu, sigma);
  alpha ~ normal(178, 20);
}
</code></pre>
<p>If you pay attention, this type of model construction is something different than what we have been doing so far. Especially the data block introduced us a new format of data declaration. I am not only talking about the J, there is also a difference in how we declared the S. Let’s break down what we did there.</p>
<p>So, first of all, J tells the program that there’s an integer J that we are going to use throughout the modeling. Right after we declare it, there is <code>int&lt;lower=1, upper=J&gt; S[N];</code>. This partindicates that there are integers of S ranging from 1 to J(2). Each of them have subscripts that are ranging from 1 to N. This way the model learns the row number of each S observation.</p>
<p>Following that, in the parameters block we are declaring alpha as a vector of J (2 in our example). Basically we told stan to create J alphas for us rather than a single one. And then we declared mu. <code>vector[N] mu = alpha[S];</code> is different than our practice so far. What we mean by this notation is, “dear Golem, for each observation in the data, mu equals to alpha.”</p>
<p>But let’s stop here for a while. Remember, we told stan to create J alphas for us. How can stan calculate the mu for a given observation when there are more than one alphas that she can chose? Answer is the subscript S. We tell Stan to use S as a map to know which alpha she should use. For each level of S, use corresponding alpha parameter for it. And since we already created mapping between S and rownumber N in the data block. Stan, then, can use this map to store corresponding mus for each observation in the data.</p>
<p>The model block is the same.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="the-many-variables-the-spurious-waffles.html#cb145-1" aria-hidden="true"></a><span class="co"># sampling</span></span>
<span id="cb145-2"><a href="the-many-variables-the-spurious-waffles.html#cb145-2" aria-hidden="true"></a>fit_index &lt;-<span class="st"> </span><span class="kw">sampling</span>(model_index.stan, </span>
<span id="cb145-3"><a href="the-many-variables-the-spurious-waffles.html#cb145-3" aria-hidden="true"></a>                      dat_index,</span>
<span id="cb145-4"><a href="the-many-variables-the-spurious-waffles.html#cb145-4" aria-hidden="true"></a>                      <span class="dt">iter=</span><span class="dv">1000</span>,</span>
<span id="cb145-5"><a href="the-many-variables-the-spurious-waffles.html#cb145-5" aria-hidden="true"></a>                      <span class="dt">chains=</span><span class="dv">2</span>,</span>
<span id="cb145-6"><a href="the-many-variables-the-spurious-waffles.html#cb145-6" aria-hidden="true"></a>                      <span class="dt">cores=</span><span class="dv">4</span>)</span></code></pre></div>
<p>And following result is matching the one in the books. In the book alphas numbered in reverse order but it doesn’t matter as long as you know the correspondence</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="the-many-variables-the-spurious-waffles.html#cb146-1" aria-hidden="true"></a><span class="kw">print</span>(fit_index, <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;sigma&quot;</span>))</span></code></pre></div>
<pre><code>## Inference for Stan model: stan-198233251f4e.
## 2 chains, each with iter=1000; warmup=500; thin=1; 
## post-warmup draws per chain=500, total post-warmup draws=1000.
## 
##            mean se_mean   sd   2.5%    25%    50%    75%  97.5% n_eff Rhat
## alpha[1] 142.60    0.05 1.78 139.16 141.40 142.51 143.84 146.11  1232    1
## alpha[2] 134.90    0.05 1.62 131.72 133.80 134.93 136.03 138.02  1127    1
## sigma     27.49    0.03 0.83  25.92  26.93  27.45  28.04  29.33   910    1
## 
## Samples were drawn using NUTS(diag_e) at Sat Jul 17 13:49:06 2021.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
</div>
<div id="many-variables" class="section level3" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> Many Variables</h3>
<p>Now let’s continue with many categorical variables</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="the-many-variables-the-spurious-waffles.html#cb148-1" aria-hidden="true"></a><span class="kw">data</span>(milk)</span>
<span id="cb148-2"><a href="the-many-variables-the-spurious-waffles.html#cb148-2" aria-hidden="true"></a>d &lt;-<span class="st"> </span>milk</span>
<span id="cb148-3"><a href="the-many-variables-the-spurious-waffles.html#cb148-3" aria-hidden="true"></a></span>
<span id="cb148-4"><a href="the-many-variables-the-spurious-waffles.html#cb148-4" aria-hidden="true"></a><span class="co"># preview levels</span></span>
<span id="cb148-5"><a href="the-many-variables-the-spurious-waffles.html#cb148-5" aria-hidden="true"></a><span class="kw">unique</span>(d<span class="op">$</span>clade)</span></code></pre></div>
<pre><code>## [1] Strepsirrhine    New World Monkey Old World Monkey Ape             
## Levels: Ape New World Monkey Old World Monkey Strepsirrhine</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="the-many-variables-the-spurious-waffles.html#cb150-1" aria-hidden="true"></a><span class="co"># convert to numeric</span></span>
<span id="cb150-2"><a href="the-many-variables-the-spurious-waffles.html#cb150-2" aria-hidden="true"></a>d<span class="op">$</span>clade_id &lt;-<span class="st"> </span><span class="kw">as.integer</span>(d<span class="op">$</span>clade)</span>
<span id="cb150-3"><a href="the-many-variables-the-spurious-waffles.html#cb150-3" aria-hidden="true"></a></span>
<span id="cb150-4"><a href="the-many-variables-the-spurious-waffles.html#cb150-4" aria-hidden="true"></a><span class="co">#scale kcal</span></span>
<span id="cb150-5"><a href="the-many-variables-the-spurious-waffles.html#cb150-5" aria-hidden="true"></a>d<span class="op">$</span>K =<span class="st"> </span>(d<span class="op">$</span>kcal.per.g <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(d<span class="op">$</span>kcal.per.g)) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(d<span class="op">$</span>kcal.per.g)</span></code></pre></div>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="the-many-variables-the-spurious-waffles.html#cb151-1" aria-hidden="true"></a>dat_many &lt;-<span class="kw">list</span>(<span class="dt">N=</span><span class="kw">NROW</span>(d),</span>
<span id="cb151-2"><a href="the-many-variables-the-spurious-waffles.html#cb151-2" aria-hidden="true"></a>                <span class="dt">C=</span>d<span class="op">$</span>clade_id,</span>
<span id="cb151-3"><a href="the-many-variables-the-spurious-waffles.html#cb151-3" aria-hidden="true"></a>                <span class="dt">K=</span>d<span class="op">$</span>K,</span>
<span id="cb151-4"><a href="the-many-variables-the-spurious-waffles.html#cb151-4" aria-hidden="true"></a>                <span class="dt">J=</span><span class="kw">length</span>(<span class="kw">unique</span>(d<span class="op">$</span>clade_id)))</span></code></pre></div>
<pre class="stan"><code>data{
  int&lt;lower=1&gt; N;
  int&lt;lower=1&gt; J;
  int&lt;lower=1, upper=J&gt; C[N];
  vector[N] K;
}
parameters{
  vector[J] alpha;
  real&lt;lower=0&gt; sigma;
}
transformed parameters{
  vector[N] mu =  alpha[C];
}
model{
  K ~ normal(mu, sigma);
  alpha ~ normal(0, 0.5);
  sigma ~ exponential(1);
}</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="the-many-variables-the-spurious-waffles.html#cb153-1" aria-hidden="true"></a>fit_many_index &lt;-<span class="st"> </span><span class="kw">sampling</span>(many_index.stan,</span>
<span id="cb153-2"><a href="the-many-variables-the-spurious-waffles.html#cb153-2" aria-hidden="true"></a>                           dat_many,</span>
<span id="cb153-3"><a href="the-many-variables-the-spurious-waffles.html#cb153-3" aria-hidden="true"></a>                           <span class="dt">iter=</span><span class="dv">1000</span>,</span>
<span id="cb153-4"><a href="the-many-variables-the-spurious-waffles.html#cb153-4" aria-hidden="true"></a>                           <span class="dt">chains=</span><span class="dv">2</span>,</span>
<span id="cb153-5"><a href="the-many-variables-the-spurious-waffles.html#cb153-5" aria-hidden="true"></a>                           <span class="dt">cores=</span><span class="dv">4</span>)</span></code></pre></div>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="the-many-variables-the-spurious-waffles.html#cb154-1" aria-hidden="true"></a><span class="kw">print</span>(fit_many_index, <span class="dt">pars=</span><span class="kw">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;sigma&quot;</span>))</span></code></pre></div>
<pre><code>## Inference for Stan model: stan-1982573a0504.
## 2 chains, each with iter=1000; warmup=500; thin=1; 
## post-warmup draws per chain=500, total post-warmup draws=1000.
## 
##           mean se_mean   sd  2.5%   25%   50%   75% 97.5% n_eff Rhat
## alpha[1] -0.47    0.01 0.25 -0.92 -0.63 -0.47 -0.31  0.03   935    1
## alpha[2]  0.35    0.01 0.22 -0.09  0.20  0.35  0.50  0.78   995    1
## alpha[3]  0.65    0.01 0.27  0.12  0.47  0.66  0.84  1.20  1062    1
## alpha[4] -0.55    0.01 0.27 -1.05 -0.74 -0.56 -0.36  0.03  1097    1
## sigma     0.80    0.00 0.12  0.60  0.71  0.79  0.87  1.05   588    1
## 
## Samples were drawn using NUTS(diag_e) at Sat Jul 17 13:49:13 2021.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<p>Now let’s add one more variable. The House from Harry Potter</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="the-many-variables-the-spurious-waffles.html#cb156-1" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">63</span>)</span>
<span id="cb156-2"><a href="the-many-variables-the-spurious-waffles.html#cb156-2" aria-hidden="true"></a>d<span class="op">$</span>house &lt;-<span class="st"> </span><span class="kw">sample</span>( <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,<span class="dt">each=</span><span class="dv">8</span>) , <span class="dt">size=</span><span class="kw">nrow</span>(d))</span></code></pre></div>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="the-many-variables-the-spurious-waffles.html#cb157-1" aria-hidden="true"></a>dat_many_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">N =</span> <span class="kw">NROW</span>(d),</span>
<span id="cb157-2"><a href="the-many-variables-the-spurious-waffles.html#cb157-2" aria-hidden="true"></a>                   <span class="dt">K =</span> d<span class="op">$</span>K,</span>
<span id="cb157-3"><a href="the-many-variables-the-spurious-waffles.html#cb157-3" aria-hidden="true"></a>                   <span class="dt">C =</span> d<span class="op">$</span>clade_id,</span>
<span id="cb157-4"><a href="the-many-variables-the-spurious-waffles.html#cb157-4" aria-hidden="true"></a>                   <span class="dt">J =</span> <span class="kw">length</span>(<span class="kw">unique</span>(d<span class="op">$</span>clade_id)),</span>
<span id="cb157-5"><a href="the-many-variables-the-spurious-waffles.html#cb157-5" aria-hidden="true"></a>                   <span class="dt">H =</span> d<span class="op">$</span>house,</span>
<span id="cb157-6"><a href="the-many-variables-the-spurious-waffles.html#cb157-6" aria-hidden="true"></a>                   <span class="dt">I =</span> <span class="kw">length</span>(<span class="kw">unique</span>(d<span class="op">$</span>house)))</span></code></pre></div>
<pre class="stan"><code>data{
  int&lt;lower=1&gt; N;
  int&lt;lower=1&gt; J;
  int&lt;lower=1&gt; I;
  int&lt;lower=1, upper=J&gt; C[N];
  int&lt;lower=1, upper=I&gt; H[N];
  vector[N] K;
}
parameters{
  vector[J] alpha_C;
  vector[I] alpha_H;
  real &lt;lower=0&gt; sigma;
}
transformed parameters{
  vector[N] mu = alpha_C[C] + alpha_H[H];
}
model{
  K ~ normal(mu, sigma);
  alpha_C ~ normal(0, 0.5);
  alpha_H ~ normal(0, 0.5);
  sigma ~ exponential(1);
}
</code></pre>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="the-many-variables-the-spurious-waffles.html#cb159-1" aria-hidden="true"></a>fit_many_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">sampling</span>(index_many_<span class="fl">1.</span>stan,</span>
<span id="cb159-2"><a href="the-many-variables-the-spurious-waffles.html#cb159-2" aria-hidden="true"></a>                       dat_many_<span class="dv">1</span>,</span>
<span id="cb159-3"><a href="the-many-variables-the-spurious-waffles.html#cb159-3" aria-hidden="true"></a>                       <span class="dt">iter=</span><span class="dv">1000</span>,</span>
<span id="cb159-4"><a href="the-many-variables-the-spurious-waffles.html#cb159-4" aria-hidden="true"></a>                       <span class="dt">cores=</span><span class="dv">4</span>,</span>
<span id="cb159-5"><a href="the-many-variables-the-spurious-waffles.html#cb159-5" aria-hidden="true"></a>                       <span class="dt">chains=</span><span class="dv">2</span>)</span></code></pre></div>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="the-many-variables-the-spurious-waffles.html#cb160-1" aria-hidden="true"></a><span class="kw">print</span>(fit_many_<span class="dv">1</span>, <span class="kw">c</span>(<span class="st">&quot;alpha_H&quot;</span>, <span class="st">&quot;alpha_C&quot;</span>, <span class="st">&quot;sigma&quot;</span>))</span></code></pre></div>
<pre><code>## Inference for Stan model: stan-1982240f15db.
## 2 chains, each with iter=1000; warmup=500; thin=1; 
## post-warmup draws per chain=500, total post-warmup draws=1000.
## 
##             mean se_mean   sd  2.5%   25%   50%   75% 97.5% n_eff Rhat
## alpha_H[1] -0.09    0.01 0.29 -0.67 -0.29 -0.09  0.10  0.51   957    1
## alpha_H[2] -0.18    0.01 0.31 -0.79 -0.39 -0.19  0.03  0.40   737    1
## alpha_H[3] -0.15    0.01 0.29 -0.71 -0.34 -0.15  0.05  0.39   707    1
## alpha_H[4]  0.48    0.01 0.31 -0.14  0.27  0.48  0.69  1.06   993    1
## alpha_C[1] -0.40    0.01 0.29 -0.99 -0.59 -0.41 -0.21  0.17   683    1
## alpha_C[2]  0.36    0.01 0.26 -0.13  0.19  0.36  0.53  0.89   588    1
## alpha_C[3]  0.52    0.01 0.31 -0.09  0.31  0.53  0.72  1.08   878    1
## alpha_C[4] -0.47    0.01 0.31 -1.03 -0.68 -0.47 -0.28  0.19  1030    1
## sigma       0.78    0.00 0.11  0.61  0.69  0.76  0.85  1.03   921    1
## 
## Samples were drawn using NUTS(diag_e) at Sat Jul 17 13:49:19 2021.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/tugberkcapraz/learning-stan-with-statistical-rethinking/edit/master/02-many_variables.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/tugberkcapraz/learning-stan-with-statistical-rethinking/blob/master/02-many_variables.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
